<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#060b14" />
    <meta name="description" content="Barangay Simulator 2.0 â€” Lead your barangay, serve your people." />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Barangay Simulator 2.0 ğŸ˜ï¸</title>
    <style>* { box-sizing: border-box; margin: 0; padding: 0; } html, body, #root { height: 100%; background: #060b14; }</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js" crossorigin></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.10/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel" data-presets="react">
const { useState, useEffect, useMemo, useRef, useCallback } = React;


const FONTS = `
@import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500;600&display=swap');
*,*::before,*::after{box-sizing:border-box;}
html,body{margin:0;padding:0;background:#060b14;}
input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:5px;border-radius:3px;background:#1a2535;outline:none;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;border-radius:50%;cursor:pointer;}
::-webkit-scrollbar{width:3px;height:3px;}
::-webkit-scrollbar-track{background:#0a1220;}
::-webkit-scrollbar-thumb{background:#1e3a4a;border-radius:2px;}
@keyframes slideInR{from{transform:translateX(110%);opacity:0;}to{transform:translateX(0);opacity:1;}}
@keyframes slideOutR{from{opacity:1;}to{transform:translateX(110%);opacity:0;}}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.5;}}
@keyframes ticker{0%{transform:translateX(100%);}100%{transform:translateX(-200%);}}
@keyframes shimmer{0%{opacity:0.7;}50%{opacity:1;}100%{opacity:0.7;}}
@keyframes bounceIn{0%{transform:scale(0.8);opacity:0;}70%{transform:scale(1.05);}100%{transform:scale(1);opacity:1;}}
`;

const MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];
const SM=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const getSeason=m=>m>=10?2:m>=5?1:0;
const SEASON_NAMES=["â˜€ï¸ Dry Season","ğŸŒ§ï¸ Rainy Season","ğŸ„ Holiday Season"];

// â”€â”€â”€ ZONES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ZONES = [
  { id:"coastal", name:"Zone 1 â€” Coastal", short:"Coastal", emoji:"ğŸ–ï¸", color:"#0ea5e9", risk:["typhoon","flood"], population:650, desc:"Low-lying shoreline area. Beautiful but flood-prone." },
  { id:"central", name:"Zone 2 â€” Central", short:"Central", emoji:"ğŸ›ï¸", color:"#22c55e", risk:[], population:900, desc:"The heart of the barangay. Safest zone." },
  { id:"upland", name:"Zone 3 â€” Upland", short:"Upland", emoji:"â›°ï¸", color:"#84cc16", risk:["landslide"], population:550, desc:"Hillside farms and homes. Landslide risk during rainy season." },
  { id:"commercial", name:"Zone 4 â€” Commercial", short:"Market", emoji:"ğŸª", color:"#f59e0b", risk:["fire","crime"], population:600, desc:"Bustling market district. Fire and crime risks." },
  { id:"residential", name:"Zone 5 â€” Residential", short:"Homes", emoji:"ğŸ ", color:"#8b5cf6", risk:["crime"], population:500, desc:"Family neighborhoods. Main source of barangay identity." },
  { id:"settlers", name:"Zone 6 â€” Smokey Hillside", short:"Settlers", emoji:"ğŸšï¸", color:"#f97316", risk:["fire","demolition","flood"], population:820, desc:"Informal settler community. Highest need, most politically complex zone. Needs urgent attention." },
];

// â”€â”€â”€ COUNCIL MEMBERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COUNCIL_MEMBERS = [
  { id:"kagawad1", name:"Kgwd. Rosario Dela Cruz", emoji:"ğŸ‘©", faction:"seniors", age:58, personality:"conservative", desc:"Longtime kagawad. Prioritizes elderly welfare and tradition." },
  { id:"kagawad2", name:"Kgwd. Edgar Macaraeg", emoji:"ğŸ‘¨", faction:"business", age:45, personality:"pragmatic", desc:"Market vendor turned official. Wants economic development." },
  { id:"kagawad3", name:"Kgwd. Liza Bantolo", emoji:"ğŸ‘©", faction:"youth", age:34, personality:"progressive", desc:"Former teacher. Strong advocate for education and youth." },
  { id:"kagawad4", name:"Kgwd. Fermin Santos", emoji:"ğŸ‘¨", faction:"civic", age:52, personality:"strict", desc:"Ex-barangay tanod chief. Focuses on peace and order." },
  { id:"kagawad5", name:"Kgwd. Maricel Aguilar", emoji:"ğŸ‘©", faction:"seniors", age:60, personality:"compassionate", desc:"Nurse practitioner. Health and social welfare champion." },
  { id:"kagawad6", name:"Kgwd. Ronnie Espiritu", emoji:"ğŸ‘¨", faction:"youth", age:29, personality:"idealistic", desc:"Young kagawad. Pushes for technology and transparency." },
  { id:"kagawad7", name:"Kgwd. Tomas Villanueva", emoji:"ğŸ‘¨", faction:"business", age:48, personality:"ambitious", desc:"Construction contractor. Wants infrastructure projects." },
  { id:"sk_chair", name:"SK Chair Jasmine Ramos", emoji:"ğŸ‘§", faction:"youth", age:22, personality:"energetic", desc:"Sangguniang Kabataan Chair. Represents youth sector." },
];

// â”€â”€â”€ NAMED RESIDENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RESIDENTS = [
  { id:"r1", name:"Aling Maria Santos", emoji:"ğŸ‘µ", age:72, job:"Retired Teacher", zone:"residential", faction:"seniors", concern:"health", dialogue:["Kapitan, ang aking gamot ay mahal na!", "Sana ay mayroon tayong health center dito.", "Salamat sa pagiging mabuting kapitan."] },
  { id:"r2", name:"Mang Tonio Cruz", emoji:"ğŸ‘´", age:65, job:"Farmer", zone:"upland", faction:"seniors", concern:"infrastructure", dialogue:["Kapitan! Ang daan patungo sa bukid ay bulok na!", "Hindi na makadaan ang aming mga produkto.", "Ang ani namin ay mababa dahil walang tulong."] },
  { id:"r3", name:"Ate Beng Reyes", emoji:"ğŸ‘©", age:38, job:"Sari-sari Store Owner", zone:"commercial", faction:"business", concern:"employment", dialogue:["Kapitan, malaki ang buwis! Hindi na kumikita ang negosyo ko.", "Kailangan namin ng livelihood center.", "Maraming salamat sa market improvements!"] },
  { id:"r4", name:"Kuya Jun Fernandez", emoji:"ğŸ‘¦", age:24, job:"Unemployed", zone:"coastal", faction:"youth", concern:"employment", dialogue:["Kapitan, walang trabaho dito sa barangay namin.", "Gusto ko sanang matuto ng bagong kasanayan.", "Kung may WiFi at computer center, malaking tulong iyon."] },
  { id:"r5", name:"Nanay Cora Mendoza", emoji:"ğŸ‘©", age:44, job:"Housewife", zone:"residential", faction:"civic", concern:"safety", dialogue:["Kapitan, nakakatakot na lumabas ng gabi!", "Mga holdaper daw sa kanto araw-araw.", "Kailangan ng mas maraming ilaw at tanod."] },
  { id:"r6", name:"Tatay Ben Ocampo", emoji:"ğŸ‘¨", age:50, job:"Jeepney Driver", zone:"central", faction:"business", concern:"infrastructure", dialogue:["Kapitan, ang kalsada ay puno ng butas!", "Nasira na ang aking sasakyan dahil sa daan.", "Sana ay ayusin ang aming mga daan agad."] },
  { id:"r7", name:"Inay Luisa Bautista", emoji:"ğŸ‘µ", age:68, job:"Laundrywoman", zone:"coastal", faction:"seniors", concern:"health", dialogue:["Kapitan, may dengue na sa aming lugar!", "Kailangan ng fogging agad dito sa Zone 1.", "Maraming bata ang may lagnat."] },
  { id:"r8", name:"Kuya Mark Dela Rosa", emoji:"ğŸ‘¦", age:19, job:"College Student", zone:"residential", faction:"youth", concern:"education", dialogue:["Kapitan! Walang libreng WiFi dito.", "Mahirap mag-aral nang walang internet.", "Sana may scholarship program para sa amin."] },
  { id:"r9", name:"Ate Rose Navarro", emoji:"ğŸ‘©", age:31, job:"Vendor", zone:"commercial", faction:"business", concern:"employment", dialogue:["Kapitan, ang bayad sa stall ay mataas na.", "Kailangan ng mas malaking palengke.", "Gusto naming magtayo ng sariling negosyo."] },
  { id:"r10", name:"Mang Bert Castillo", emoji:"ğŸ‘¨", age:55, job:"Fisherman", zone:"coastal", faction:"civic", concern:"environment", dialogue:["Kapitan, may nagtatapon ng basura sa dagat!", "Nawawala na ang isda dahil sa polusyon.", "Kailangan ng stricter na environmental rules."] },
  { id:"r11", name:"Ate Gina Torres", emoji:"ğŸ‘©", age:35, job:"Barangay Health Worker", zone:"central", faction:"seniors", concern:"health", dialogue:["Kapitan, kulang kami sa gamot at supplies.", "Kailangan ng mas maraming BHW.", "Maraming pasyente pero maliit na health center."] },
  { id:"r12", name:"Lolo Ramon Villanueva", emoji:"ğŸ‘´", age:78, job:"Retired Soldier", zone:"upland", faction:"civic", concern:"safety", dialogue:["Sa aking panahon, tahimik ang barangay.", "Ngayon, maraming kaguluhan.", "Kailangan ng disiplina at mahigpit na pamumuno."] },
  { id:"r13", name:"Neneng Joy Aquino", emoji:"ğŸ‘§", age:16, job:"Student", zone:"residential", faction:"youth", concern:"education", dialogue:["Kapitan! Gusto namin ng covered court para sa sports.", "Walang lugar para maglaro nang ligtas.", "May talent kami sa basketball kapag may pagsasanay!"] },
  { id:"r14", name:"Mang Pedro Gonzales", emoji:"ğŸ‘¨", age:42, job:"Construction Worker", zone:"upland", faction:"business", concern:"infrastructure", dialogue:["Kapitan, walang trabaho sa lugar namin.", "Parang nalilimutan ang Zone 3.", "Kung may projects dito, matutulungan kami."] },
  { id:"r15", name:"Ate Nene Ramos", emoji:"ğŸ‘©", age:48, job:"PTA President", zone:"residential", faction:"civic", concern:"education", dialogue:["Kapitan, kulang sa silid-aralan ang aming eskwelahan!", "30 estudyante sa iisang klase!", "Kailangan ng bagong school building agad."] },
  { id:"r16", name:"Kuya Randy Flores", emoji:"ğŸ‘¦", age:28, job:"Fisherman", zone:"coastal", faction:"business", concern:"employment", dialogue:["Mababa na ang kita sa pangingisda, Kapitan.", "Kailangan ng mas magandang palengke.", "Tulungan n'yo kami ng livelihood program!"] },
  { id:"r17", name:"Doktor Reyes", emoji:"ğŸ‘¨â€âš•ï¸", age:42, job:"Rural Doctor", zone:"central", faction:"seniors", concern:"health", dialogue:["Kailangan nating palakasin ang health system, Kapitan.", "Ang preventive care ay mas mura kaysa curative.", "Salamat sa suporta sa aming health center."] },
  { id:"r18", name:"Ate Nora Dela Cruz", emoji:"ğŸ‘©", age:38, job:"Farmer", zone:"upland", faction:"civic", concern:"environment", dialogue:["Umaagos na ang lupa namin tuwing umuulan, Kapitan.", "Kailangan ng reforestation sa bundok.", "Ang mga puno ang nagpoprotekta sa amin."] },
  { id:"r19", name:"Kuya Arnel Pascual", emoji:"ğŸ‘¦", age:34, job:"Market Stall Owner", zone:"commercial", faction:"business", concern:"safety", dialogue:["Nasusunog ang mga tindahan tuwing dry season, Kapitan!", "Wala kaming fire extinguisher.", "Kailangan ng fire sub-station sa aming area."] },
  { id:"r20", name:"Tatay Oscar Lim", emoji:"ğŸ‘¨", age:55, job:"Barangay Watch", zone:"residential", faction:"civic", concern:"safety", dialogue:["Halos lahat ng ilaw sa kanto ay sira na, Kapitan.", "Madilim ang daan pauwi ng gabi.", "Pakiayos ang mga solar streetlight."] },
  // ZONE 6 â€” INFORMAL SETTLERS
  { id:"r21", name:"Manang Lolit Reyes", emoji:"ğŸ‘©", age:55, job:"Community Leader", zone:"settlers", faction:"settlers", concern:"housing", dialogue:["Kapitan, sinasabihan kaming umalis sa aming tahanan!", "Wala kaming ibang mapupuntahan.", "Ikaw ang aming tanging pag-asa, Kapitan."] },
  { id:"r22", name:"Kuya Dodong Marquez", emoji:"ğŸ‘¦", age:32, job:"Construction Worker", zone:"settlers", faction:"settlers", concern:"employment", dialogue:["Walang steady na trabaho kami dito, Kapitan.", "Kung may livelihood program, makakatulong iyon.", "Hindi kami tamad â€” kailangan lang ng pagkakataon."] },
  { id:"r23", name:"Aling Fe Castillo", emoji:"ğŸ‘©", age:48, job:"Vendor", zone:"settlers", faction:"settlers", concern:"housing", dialogue:["Ang aming bahay ay gawa sa karton at yero, Kapitan!", "Tuwing bagyo, takot kaming lahat.", "Sana may matibay na tirahan kami."] },
  { id:"r24", name:"Tatay Elmer Tolentino", emoji:"ğŸ‘¨", age:45, job:"Scrap Collector", zone:"settlers", faction:"settlers", concern:"environment", dialogue:["Walang tamang basurahan sa aming lugar, Kapitan.", "Lagi kaming binabasag ng city hall sa basura.", "Tulungan n'yo kaming ayusin ang aming komunidad."] },
  { id:"r25", name:"Ate Marites Santos", emoji:"ğŸ‘©", age:29, job:"Single Mother", zone:"settlers", faction:"settlers", concern:"health", dialogue:["Ang aking mga anak ay madalas magkasakit, Kapitan.", "Walang malinis na tubig sa aming zona.", "Kahit simpleng water tap lang, malaking tulong na iyon."] },
  { id:"r26", name:"Lolo Isko Manalo", emoji:"ğŸ‘´", age:70, job:"Zone 6 Elder", zone:"settlers", faction:"settlers", concern:"housing", dialogue:["30 taon na kaming nakatira dito, Kapitan.", "Hindi kami mga squatter â€” ito ang aming tahanan.", "Huwag po kaming pabayaan."] },
  { id:"r27", name:"Yoyo Reyes", emoji:"ğŸ‘¦", age:14, job:"Out-of-School Youth", zone:"settlers", faction:"youth", concern:"education", dialogue:["Hindi ako nakapag-aral dahil sa gastos, Kapitan.", "Gusto ko sanang matuto ng trabaho.", "Kung may livelihood program, tutulungan n'yo ba kami?"] },
  { id:"r28", name:"Ate Luz Fernandez", emoji:"ğŸ‘©", age:36, job:"Health Volunteer", zone:"settlers", faction:"settlers", concern:"health", dialogue:["Walang health worker sa Zone 6, Kapitan.", "Ang mga bata dito ay hindi nababakunan.", "Kailangan ng mobile health clinic dito."] },
];

// â”€â”€â”€ MISSIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MISSION_POOL = [
  { id:"m_health1", title:"Dengue Prevention Drive", emoji:"ğŸ¦Ÿ", from:"r11", desc:"Ate Gina requests a community health drive to prevent dengue in Zone 1.", reward:{ health:8, happiness:6, faction:"seniors", factionBoost:8 }, deadline:3, requirement:null, type:"health" },
  { id:"m_infra1", title:"Fix Zone 3 Farm Road", emoji:"ğŸ›£ï¸", from:"r2", desc:"Mang Tonio's farm road is impassable. Costs â‚±15,000 to repair.", reward:{ infrastructure:10, happiness:8, faction:"business", factionBoost:6 }, deadline:2, requirement:{ budget:15000 }, cost:15000, type:"infra" },
  { id:"m_edu1", title:"School Supplies Drive", emoji:"ğŸ“š", from:"r15", desc:"Ate Nene requests â‚±8,000 worth of school supplies for indigent students.", reward:{ education:8, happiness:9, faction:"youth", factionBoost:10 }, deadline:2, requirement:{ budget:8000 }, cost:8000, type:"education" },
  { id:"m_safety1", title:"Neighborhood Watch Setup", emoji:"ğŸ”¦", from:"r5", desc:"Nanay Cora wants to organize a neighborhood watch group in Zone 5.", reward:{ safety:10, happiness:7, faction:"civic", factionBoost:8 }, deadline:3, requirement:null, cost:5000, type:"safety" },
  { id:"m_env1", title:"Coastal Cleanup Campaign", emoji:"ğŸŒŠ", from:"r10", desc:"Mang Bert is organizing a cleanup of the coastal area. Needs â‚±6,000 for equipment.", reward:{ environment:12, health:4, happiness:8, faction:"civic", factionBoost:6 }, deadline:3, requirement:{ budget:6000 }, cost:6000, type:"environment" },
  { id:"m_emp1", title:"Magtanim Training Program", emoji:"ğŸŒ¾", from:"r2", desc:"Mang Tonio wants a free farming skills seminar. Costs â‚±10,000 to organize.", reward:{ employment:10, happiness:8, faction:"business", factionBoost:7 }, deadline:3, requirement:{ budget:10000 }, cost:10000, type:"employment" },
  { id:"m_youth1", title:"Youth Sports Tournament", emoji:"âš½", from:"r13", desc:"Neneng Joy wants to host a barangay sports fest for youth. Budget: â‚±12,000.", reward:{ happiness:12, safety:6, education:4, faction:"youth", factionBoost:12 }, deadline:2, requirement:{ budget:12000 }, cost:12000, type:"recreation" },
  { id:"m_senior1", title:"Senior Medical Mission", emoji:"ğŸ’Š", from:"r1", desc:"Aling Maria is organizing a free medical checkup for all seniors. Cost: â‚±9,000.", reward:{ health:10, happiness:10, faction:"seniors", factionBoost:12 }, deadline:2, requirement:{ budget:9000 }, cost:9000, type:"health" },
  { id:"m_biz1", title:"Business Registration Drive", emoji:"ğŸ“‹", from:"r3", desc:"Ate Beng wants help organizing a one-day registration event for local businesses.", reward:{ employment:8, happiness:7, budget:5000, faction:"business", factionBoost:9 }, deadline:3, requirement:null, cost:3000, type:"economy" },
  { id:"m_water1", title:"Emergency Water Supply", emoji:"ğŸ’§", from:"r7", desc:"Inay Luisa's area has no water for 5 days. Needs emergency water truck delivery.", reward:{ health:6, happiness:9, faction:"seniors", factionBoost:8 }, deadline:1, requirement:{ budget:8000 }, cost:8000, type:"health" },
  { id:"m_wifi1", title:"School WiFi Connection", emoji:"ğŸ“¶", from:"r8", desc:"Kuya Mark wants WiFi installed in the school library for student research.", reward:{ education:9, happiness:8, faction:"youth", factionBoost:10 }, deadline:3, requirement:{ budget:7000, building:"school" }, cost:7000, type:"education" },
  { id:"m_lights1", title:"Dark Street Solar Lights", emoji:"ğŸ’¡", from:"r5", desc:"Nanay Cora reports several dark alleys in Zone 5 are used by criminals.", reward:{ safety:9, happiness:8, faction:"civic", factionBoost:7 }, deadline:2, requirement:{ budget:10000 }, cost:10000, type:"safety" },
  { id:"m_livelihood1", title:"Livelihood Starter Kits", emoji:"ğŸ§µ", from:"r4", desc:"Kuya Jun and other unemployed youth need starter kits for micro-enterprises.", reward:{ employment:10, happiness:9, faction:"youth", factionBoost:8 }, deadline:3, requirement:{ budget:11000 }, cost:11000, type:"economy" },
  { id:"m_fire1", title:"Fire Safety Inspection", emoji:"ğŸ”¥", from:"r3", desc:"Ate Beng reports fire hazards in the commercial zone. Pay â‚±5,000 for inspection.", reward:{ safety:8, happiness:6, faction:"civic", factionBoost:5 }, deadline:2, requirement:{ budget:5000 }, cost:5000, type:"safety" },
  { id:"m_garden1", title:"Community Vegetable Garden", emoji:"ğŸŒ¿", from:"r10", desc:"Mang Bert wants to start a community garden in an idle lot. Cost: â‚±7,000.", reward:{ health:6, happiness:9, environment:8, faction:"civic", factionBoost:7 }, deadline:4, requirement:{ budget:7000 }, cost:7000, type:"environment" },
  { id:"m_sanitation1", title:"Septic Tank Repair Drive", emoji:"ğŸš½", from:"r6", desc:"Tatay Ben reports sewage flooding from broken septic tanks. Needs â‚±12,000 to fix.", reward:{ health:8, happiness:7, infrastructure:6, faction:"civic", factionBoost:7 }, deadline:3, requirement:{ budget:12000 }, cost:12000, type:"health" },
  { id:"m_fisherfolk1", title:"Fisherfolk Equipment Fund", emoji:"ğŸ£", from:"r10", desc:"Mang Bert requests seed funding for fishing gear for displaced coastal fisherfolk.", reward:{ employment:9, happiness:8, faction:"civic", factionBoost:8 }, deadline:3, requirement:{ budget:9000 }, cost:9000, type:"employment" },
  { id:"m_eldercare1", title:"Home Care for Seniors", emoji:"ğŸ ", from:"r1", desc:"Aling Maria requests a volunteer home care program for bedridden elderly residents.", reward:{ health:7, happiness:10, faction:"seniors", factionBoost:11 }, deadline:4, requirement:null, cost:4000, type:"health" },
  { id:"m_sciencefair1", title:"Barangay Science Fair", emoji:"ğŸ”¬", from:"r8", desc:"Kuya Mark wants to organize a science fair with â‚±6,000 in prizes and materials.", reward:{ education:10, happiness:8, faction:"youth", factionBoost:9 }, deadline:3, requirement:{ budget:6000 }, cost:6000, type:"education" },
  { id:"m_mangrove1", title:"Mangrove Planting Day", emoji:"ğŸŒ±", from:"r10", desc:"Mang Bert is organizing a coastal mangrove planting event to protect the shoreline.", reward:{ environment:10, health:4, happiness:8, faction:"civic", factionBoost:8 }, deadline:4, requirement:{ budget:5000 }, cost:5000, type:"environment" },
  { id:"m_mural1", title:"Community Mural Project", emoji:"ğŸ¨", from:"r4", desc:"Kuya Jun and local youth want to paint a barangay identity mural. Budget: â‚±4,000.", reward:{ happiness:10, employment:5, faction:"youth", factionBoost:9 }, deadline:4, requirement:{ budget:4000 }, cost:4000, type:"recreation" },
  { id:"m_tricycle1", title:"Tricycle Route Proposal", emoji:"ğŸ›º", from:"r6", desc:"Tatay Ben is petitioning for a new barangay-to-market tricycle route. Cost: â‚±8,000.", reward:{ employment:7, happiness:9, infrastructure:5, faction:"business", factionBoost:8 }, deadline:3, requirement:{ budget:8000 }, cost:8000, type:"economy" },
  { id:"m_legal1", title:"Legal Aid for Settlers", emoji:"âš–ï¸", from:"r21", desc:"Manang Lolit needs legal assistance to fight the demolition order for Zone 6.", reward:{ safety:5, happiness:12, faction:"settlers", factionBoost:15 }, deadline:2, requirement:{ budget:8000 }, cost:8000, type:"housing" },
  { id:"m_watertap1", title:"Water Tap for Zone 6", emoji:"ğŸš°", from:"r25", desc:"Ate Marites needs a proper water tap connection for Zone 6 families.", reward:{ health:10, happiness:11, faction:"settlers", factionBoost:10 }, deadline:3, requirement:{ budget:10000 }, cost:10000, type:"housing" },
  { id:"m_shelter1", title:"Emergency Shelter Repair", emoji:"ğŸšï¸", from:"r23", desc:"Aling Fe's area has several severely damaged shelters needing urgent repair.", reward:{ infrastructure:7, happiness:10, faction:"settlers", factionBoost:11 }, deadline:2, requirement:{ budget:9000 }, cost:9000, type:"housing" },
  { id:"m_osy1", title:"Out-of-School Youth Program", emoji:"ğŸ“", from:"r27", desc:"Yoyo Reyes and other OSY in Zone 6 need a skills training program. Cost: â‚±9,000.", reward:{ education:9, employment:6, happiness:9, faction:"youth", factionBoost:10 }, deadline:3, requirement:{ budget:9000 }, cost:9000, type:"education" },
  { id:"m_zone6fire1", title:"Zone 6 Fire Hazard Audit", emoji:"ğŸ§¯", from:"r23", desc:"Aling Fe warns that nipa huts in Zone 6 are major fire risks. Inspection: â‚±6,000.", reward:{ safety:8, happiness:7, faction:"settlers", factionBoost:9 }, deadline:2, requirement:{ budget:6000 }, cost:6000, type:"safety" },
  { id:"m_settlers_livelihood1", title:"Zone 6 Livelihood Kits", emoji:"ğŸª¡", from:"r22", desc:"Kuya Dodong requests livelihood packages for Zone 6 residents. Cost: â‚±12,000.", reward:{ employment:10, happiness:10, faction:"settlers", factionBoost:12 }, deadline:3, requirement:{ budget:12000 }, cost:12000, type:"employment" },
  { id:"m_vaccine1", title:"Zone 6 Vaccination Drive", emoji:"ğŸ’‰", from:"r28", desc:"Ate Luz reports many Zone 6 children are unvaccinated. Cost: â‚±7,000.", reward:{ health:10, happiness:9, faction:"settlers", factionBoost:10 }, deadline:3, requirement:{ budget:7000 }, cost:7000, type:"health" },
  { id:"m_fiesta1", title:"Zone 6 Community Festival", emoji:"ğŸŠ", from:"r21", desc:"Manang Lolit wants to organize a mini-festival for Zone 6 morale. Cost: â‚±6,000.", reward:{ happiness:14, faction:"settlers", factionBoost:13 }, deadline:3, requirement:{ budget:6000 }, cost:6000, type:"recreation" },
];

// â”€â”€â”€ BUILDINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BUILDINGS = [
  { id:"health_center", name:"Health Center", emoji:"ğŸ¥", cat:"health", zone:"central", cost:50000, upgCost:35000, upkeep:1500, maxLvl:3, bldMonths:2, effects:{ health:12, happiness:5 }, desc:"Basic healthcare for all residents." },
  { id:"water_system", name:"Water System", emoji:"ğŸ’§", cat:"health", zone:"central", cost:65000, upgCost:42000, upkeep:1800, maxLvl:3, bldMonths:3, effects:{ health:15, happiness:12, infrastructure:8 }, desc:"Clean piped water for all households." },
  { id:"school", name:"Elementary School", emoji:"ğŸ«", cat:"education", zone:"residential", cost:80000, upgCost:50000, upkeep:2000, maxLvl:3, bldMonths:3, effects:{ education:15, happiness:6 }, desc:"Primary education for youth." },
  { id:"daycare", name:"Day Care Center", emoji:"ğŸ§’", cat:"education", zone:"residential", cost:25000, upgCost:16000, upkeep:800, maxLvl:2, bldMonths:1, effects:{ happiness:10, education:6 }, desc:"Early childhood care and development." },
  { id:"library", name:"Barangay Library", emoji:"ğŸ“š", cat:"education", zone:"central", cost:35000, upgCost:22000, upkeep:600, maxLvl:2, bldMonths:2, effects:{ education:12, happiness:7 }, desc:"Books and learning resources." },
  { id:"wifi_hub", name:"Free WiFi Hub", emoji:"ğŸ“¶", cat:"education", zone:"central", cost:20000, upgCost:13000, upkeep:1000, maxLvl:2, bldMonths:1, effects:{ education:8, happiness:8, employment:4 }, desc:"Digital access and connectivity." },
  { id:"covered_court", name:"Covered Court", emoji:"ğŸ€", cat:"recreation", zone:"residential", cost:30000, upgCost:20000, upkeep:500, maxLvl:2, bldMonths:2, effects:{ happiness:12, safety:4 }, desc:"Sports and community activities." },
  { id:"multi_hall", name:"Multi-Purpose Hall", emoji:"ğŸ›ï¸", cat:"recreation", zone:"central", cost:90000, upgCost:58000, upkeep:1500, maxLvl:2, bldMonths:3, effects:{ happiness:15, education:5, employment:5 }, desc:"Events, training, community gatherings." },
  { id:"garden", name:"Community Garden", emoji:"ğŸŒ¿", cat:"recreation", zone:"upland", cost:15000, upgCost:10000, upkeep:300, maxLvl:2, bldMonths:1, effects:{ happiness:8, health:6, environment:8 }, desc:"Green space and food security." },
  { id:"eco_park", name:"Eco Park", emoji:"ğŸŒ³", cat:"recreation", zone:"upland", cost:55000, upgCost:35000, upkeep:700, maxLvl:2, bldMonths:2, effects:{ happiness:12, health:8, environment:15 }, desc:"Urban green lung." },
  { id:"police_post", name:"Police Outpost", emoji:"ğŸš”", cat:"safety", zone:"commercial", cost:35000, upgCost:22000, upkeep:2500, maxLvl:2, bldMonths:1, effects:{ safety:18, happiness:4 }, desc:"Deters crime and maintains peace." },
  { id:"cctv", name:"CCTV Network", emoji:"ğŸ“¹", cat:"safety", zone:"commercial", cost:40000, upgCost:25000, upkeep:800, maxLvl:3, bldMonths:1, effects:{ safety:12, happiness:6 }, desc:"Surveillance reduces crime." },
  { id:"evacuation", name:"Evacuation Center", emoji:"â›º", cat:"safety", zone:"central", cost:55000, upgCost:35000, upkeep:400, maxLvl:2, bldMonths:2, effects:{ safety:14, infrastructure:5 }, desc:"Disaster shelter and staging." },
  { id:"fire_station", name:"Fire Sub-Station", emoji:"ğŸš’", cat:"safety", zone:"commercial", cost:75000, upgCost:48000, upkeep:3000, maxLvl:2, bldMonths:3, effects:{ safety:16, happiness:8 }, desc:"Rapid fire response." },
  { id:"road", name:"Road Concreting", emoji:"ğŸ›£ï¸", cat:"infra", zone:"central", cost:40000, upgCost:28000, upkeep:200, maxLvl:3, bldMonths:2, effects:{ infrastructure:14, happiness:7 }, desc:"Durable roads reduce flooding." },
  { id:"drainage", name:"Drainage Canal", emoji:"ğŸŒŠ", cat:"infra", zone:"coastal", cost:50000, upgCost:32000, upkeep:500, maxLvl:2, bldMonths:3, effects:{ infrastructure:16, health:6, environment:6 }, desc:"Prevents flooding in Zone 1." },
  { id:"solar", name:"Solar Streetlights", emoji:"ğŸ’¡", cat:"infra", zone:"residential", cost:45000, upgCost:28000, upkeep:300, maxLvl:2, bldMonths:1, effects:{ safety:8, happiness:10, infrastructure:6 }, desc:"Eco-friendly night lighting." },
  { id:"waste_facility", name:"Waste Sorting Facility", emoji:"â™»ï¸", cat:"infra", zone:"upland", cost:45000, upgCost:30000, upkeep:1200, maxLvl:2, bldMonths:2, effects:{ environment:18, health:8, happiness:5 }, desc:"Proper waste segregation." },
  { id:"market", name:"Public Market", emoji:"ğŸ›’", cat:"economy", zone:"commercial", cost:70000, upgCost:45000, upkeep:1000, maxLvl:3, bldMonths:3, effects:{ employment:12, happiness:8, budget_monthly:3000 }, desc:"Boosts trade. +â‚±3K/mo per level." },
  { id:"livelihood", name:"Livelihood Center", emoji:"ğŸ§µ", cat:"economy", zone:"commercial", cost:60000, upgCost:38000, upkeep:1200, maxLvl:3, bldMonths:2, effects:{ employment:15, happiness:9 }, desc:"Skills training programs." },
  { id:"night_market", name:"Night Market", emoji:"ğŸŒ™", cat:"economy", zone:"commercial", cost:35000, upgCost:22000, upkeep:600, maxLvl:2, bldMonths:1, effects:{ employment:8, happiness:12, budget_monthly:1500 }, desc:"Evening economy for vendors." },
  { id:"coop", name:"Barangay Cooperative", emoji:"ğŸª", cat:"economy", zone:"commercial", cost:50000, upgCost:32000, upkeep:800, maxLvl:2, bldMonths:2, effects:{ employment:12, happiness:10, budget_monthly:2000 }, desc:"Community-owned enterprise." },
  { id:"senior_center", name:"Senior Citizens Center", emoji:"ğŸ‘´", cat:"social", zone:"residential", cost:40000, upgCost:26000, upkeep:1000, maxLvl:2, bldMonths:2, effects:{ happiness:14, health:8 }, desc:"Services for the elderly." },
  { id:"youth_center", name:"Youth Development Center", emoji:"ğŸ¯", cat:"social", zone:"residential", cost:45000, upgCost:28000, upkeep:1100, maxLvl:2, bldMonths:2, effects:{ happiness:12, education:8, safety:6 }, desc:"Youth engagement programs." },
  { id:"job_office", name:"Job Placement Office", emoji:"ğŸ’¼", cat:"social", zone:"central", cost:30000, upgCost:20000, upkeep:900, maxLvl:2, bldMonths:1, effects:{ employment:10, happiness:7 }, desc:"Connects residents to jobs." },
];

// â”€â”€â”€ PROJECTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PROJECTS = [
  { id:"flood_control", name:"Flood Control System", emoji:"ğŸŒŠ", zone:"coastal", cost:200000, months:6, effects:{ infrastructure:25, health:10, environment:12, happiness:15 }, desc:"Ends seasonal flooding in Zone 1 permanently." },
  { id:"farm_road", name:"Farm-to-Market Road", emoji:"ğŸšœ", zone:"upland", cost:180000, months:5, effects:{ employment:20, infrastructure:18, happiness:14 }, desc:"Connects upland farms to the market." },
  { id:"solar_grid", name:"Solar Power Grid", emoji:"â˜€ï¸", zone:"upland", cost:250000, months:6, effects:{ infrastructure:20, environment:20, happiness:18, budget_monthly:5000 }, desc:"Community solar reduces power costs permanently." },
  { id:"water_tower", name:"Water Reservoir Tower", emoji:"ğŸ—¼", zone:"central", cost:160000, months:4, effects:{ health:20, infrastructure:15, happiness:16 }, desc:"High-capacity water supply for all zones." },
  { id:"bgry_road", name:"Barangay-Wide Road Network", emoji:"ğŸ›£ï¸", zone:"central", cost:300000, months:8, effects:{ infrastructure:30, employment:10, happiness:20 }, desc:"Full concrete roads for all sitios." },
  { id:"medical_complex", name:"Barangay Medical Complex", emoji:"ğŸ¥", zone:"central", cost:280000, months:7, effects:{ health:30, happiness:22, employment:8 }, desc:"Full-service health facility." },
  { id:"school_complex", name:"School Building Complex", emoji:"ğŸ«", zone:"residential", cost:260000, months:7, effects:{ education:28, happiness:20, employment:6 }, desc:"Multi-storey school with labs." },
  { id:"eco_village", name:"Eco-Village Resettlement", emoji:"ğŸ˜ï¸", zone:"coastal", cost:350000, months:9, effects:{ infrastructure:20, health:12, happiness:25, environment:15 }, desc:"Planned community for informal settlers." },
];

// â”€â”€â”€ EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const EVENTS = [
  { id:"typhoon", name:"Typhoon Signal #2", emoji:"ğŸŒ€", type:"crisis", season:1, weight:3, zone:"coastal",
    desc:"A powerful typhoon is bearing down. Coastal families are at risk.",
    choices:[
      { label:"Full Emergency Response ğŸš’", desc:"Mobilize resources, coordinate with NDRRMC, pre-position goods.", effects:{ budget:-25000, infrastructure:-5, happiness:12, safety:4, integrity:3 } },
      { label:"Basic Protocol Only ğŸ“‹", desc:"Issue warnings and wait.", effects:{ budget:-5000, infrastructure:-22, health:-8, happiness:-15, integrity:-2 } },
    ]},
  { id:"dengue", name:"Dengue Outbreak", emoji:"ğŸ¦Ÿ", type:"crisis", season:1, weight:2, zone:"coastal",
    desc:"Dengue cases doubling each week. Two children hospitalized.",
    choices:[
      { label:"Mass Fogging + Medical Mission ğŸ’Š", desc:"Deploy fogging, free blood tests, medicine.", effects:{ budget:-13000, health:5, happiness:10, integrity:2 } },
      { label:"Info Drive Only ğŸ“¢", desc:"Post advisories only.", effects:{ health:-20, happiness:-15, budget:-2000 } },
    ]},
  { id:"fire", name:"Fire Incident ğŸ”¥", emoji:"ğŸ”¥", type:"crisis", season:0, weight:2, zone:"commercial",
    desc:"A blaze started in Zone 4. 12 families displaced.",
    choices:[
      { label:"Emergency Housing & Full Aid ğŸ ", desc:"Shelters, food, rebuilding aid.", effects:{ budget:-22000, infrastructure:-5, happiness:12, integrity:4 } },
      { label:"File DSWD Assistance Only ğŸ“", desc:"Paperwork but no direct barangay aid.", effects:{ budget:-1500, infrastructure:-18, happiness:-22, integrity:-5 } },
    ]},
  { id:"flood", name:"Flash Flood", emoji:"ğŸŒŠ", type:"crisis", season:1, weight:3, zone:"coastal",
    desc:"Monsoon floods stranded families in Zone 1.",
    choices:[
      { label:"Rescue Operations + Pump-Out ğŸ›¶", desc:"Boats, pumps, hot meals.", effects:{ budget:-12000, infrastructure:-5, happiness:10, safety:3, integrity:2 } },
      { label:"Wait for Natural Recession â³", desc:"Issue advisory and wait.", effects:{ infrastructure:-22, health:-10, happiness:-18, integrity:-3 } },
    ]},
  { id:"landslide", name:"Landslide Warning", emoji:"â›°ï¸", type:"crisis", season:1, weight:2, zone:"upland",
    desc:"Continuous rain destabilized slopes in Zone 3.",
    choices:[
      { label:"Mandatory Evacuation ğŸƒ", desc:"Enforce relocation to evacuation center.", effects:{ budget:-9000, safety:12, happiness:6, integrity:2 } },
      { label:"Voluntary Advisory Only", desc:"Warn residents but let them decide.", effects:{ safety:-16, health:-5, happiness:-8, integrity:-2 } },
    ]},
  { id:"crime_wave", name:"Crime Wave", emoji:"âš ï¸", type:"crisis", season:0, weight:2, zone:"commercial",
    desc:"Armed robberies terrorizing the barangay.",
    choices:[
      { label:"Night Patrols + Hotline ğŸ“", desc:"24/7 tanod patrols and tip hotline.", effects:{ budget:-8000, safety:10, happiness:12, integrity:2 } },
      { label:"Crackdown with PNP ğŸš”", desc:"Police-led operation. Quick but divisive.", effects:{ budget:-3500, safety:15, happiness:-5 } },
    ]},
  { id:"drug_problem", name:"Drug Problem Surfacing", emoji:"ğŸ’‰", type:"crisis", season:0, weight:2,
    desc:"Drug use increasing among youth. Parents alarmed.",
    choices:[
      { label:"Community Rehab ğŸ’š", desc:"Healing center, counseling, reintegration.", effects:{ budget:-11000, safety:5, health:6, happiness:8, integrity:4 } },
      { label:"Police Enforcement ğŸš”", desc:"Crackdown operation.", effects:{ budget:-4000, safety:14, happiness:-8, integrity:-2 } },
    ]},
  { id:"protest", name:"Residents' Protest ğŸ“¢", emoji:"ğŸ“¢", type:"crisis", season:0, weight:2,
    desc:"Hundreds marching outside barangay hall.",
    choices:[
      { label:"Open Town Hall ğŸ¤", desc:"Listen and commit to action items.", effects:{ happiness:16, budget:-2000, integrity:6, safety:2 } },
      { label:"Disperse Crowd ğŸš«", desc:"Have tanods break it up.", effects:{ happiness:-28, safety:-14, integrity:-10 } },
    ]},
  { id:"corruption_exposed", name:"Corruption Allegation!", emoji:"ğŸ“°", type:"crisis", season:0, weight:1,
    desc:"Media reporting alleged ghost projects in your barangay.",
    choices:[
      { label:"Full Audit + Transparency ğŸ“Š", desc:"Submit to COA audit, publish all transactions.", effects:{ integrity:10, happiness:8, budget:-3000 } },
      { label:"Deny and Discredit ğŸ™‰", desc:"Issue denial, discourage coverage.", effects:{ integrity:-20, happiness:-12 } },
    ]},
  { id:"water_shortage", name:"Water Shortage ğŸš°", emoji:"ğŸš°", type:"crisis", season:0, weight:1,
    desc:"Water pump broke. 3 days without water.",
    choices:[
      { label:"Emergency Repair + Water Trucks ğŸš›", desc:"Fast repair plus temporary delivery.", effects:{ budget:-9000, health:-2, happiness:8, integrity:2 } },
      { label:"Ask LWUA for Help Only", desc:"File request and wait.", effects:{ health:-18, happiness:-16, infrastructure:-5 } },
    ]},
  // GOOD EVENTS
  { id:"ira_release", name:"IRA Budget Release ğŸ’¸", emoji:"ğŸ’¸", type:"good", season:null, weight:3, desc:"National government released supplemental IRA funds!", effects:{ budget:42000, happiness:5 } },
  { id:"dilg_recognition", name:"DILG Seal of Good LGU", emoji:"ğŸ…", type:"good", season:null, weight:1, desc:"Your barangay received the DILG Seal of Good Local Governance!", effects:{ happiness:18, integrity:8, budget:20000 } },
  { id:"festival", name:"Barangay Fiesta! ğŸŠ", emoji:"ğŸ‰", type:"good", season:2, weight:2, desc:"Annual fiesta boosts morale!", effects:{ happiness:20, budget:-7000, employment:3 } },
  { id:"dswd_aid", name:"DSWD Cash Aid", emoji:"ğŸ¤", type:"good", season:null, weight:2, desc:"Cash transfers successfully released.", effects:{ happiness:14, budget:12000 } },
  { id:"ngo_partner", name:"NGO Partnership", emoji:"ğŸŒ", type:"good", season:null, weight:2, desc:"International NGO partnered for programs!", effects:{ health:10, education:8, employment:6, budget:20000 } },
  { id:"business_invest", name:"New Business Opens", emoji:"ğŸ¢", type:"good", season:null, weight:2, desc:"A company opened a branch in your area!", effects:{ employment:14, budget:15000, happiness:10 } },
  { id:"infra_grant", name:"DPWH Infrastructure Grant", emoji:"ğŸ”§", type:"good", season:null, weight:2, desc:"DPWH approved road funding!", effects:{ infrastructure:14, budget:24000, happiness:8 } },
  { id:"sports_win", name:"Barangay Cup Champions!", emoji:"ğŸ†", type:"good", season:0, weight:1, desc:"Youth athletes swept the district games!", effects:{ happiness:18, safety:4, education:4 } },
  { id:"clean_award", name:"Cleanest Barangay Award", emoji:"â™»ï¸", type:"good", season:null, weight:1, desc:"Regional cleanest community award won!", effects:{ environment:12, health:6, happiness:14, budget:8000, integrity:4 } },
];

// â”€â”€â”€ POLICIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const POLICIES = [
  { id:"zero_waste", name:"Zero Waste Ordinance", emoji:"â™»ï¸", cost:5000, monthly:600, effects:{ environment:8, health:4, happiness:3 }, bonus:{ environment:0.3 }, desc:"Mandatory segregation and composting.", faction:"civic", councilThreshold:3 },
  { id:"anti_drug", name:"Anti-Drug Campaign", emoji:"ğŸš«", cost:10000, monthly:1200, effects:{ safety:8, happiness:3 }, bonus:{ safety:0.35 }, desc:"Community prevention and rehab.", faction:"civic", councilThreshold:4 },
  { id:"senior_aid", name:"Senior Citizen Benefits", emoji:"ğŸ‘´", cost:8000, monthly:1800, effects:{ happiness:12, health:6 }, bonus:{ happiness:0.3 }, desc:"Monthly allowance and medical subsidies.", faction:"seniors", councilThreshold:3 },
  { id:"scholar", name:"Scholarship Program", emoji:"ğŸ“", cost:12000, monthly:2800, effects:{ education:14, happiness:8 }, bonus:{ education:0.45 }, desc:"Full scholarships for deserving youth.", faction:"youth", councilThreshold:4 },
  { id:"livelihood_aid", name:"Livelihood Assistance", emoji:"ğŸ’°", cost:9000, monthly:2000, effects:{ employment:10, happiness:6 }, bonus:{ employment:0.4 }, desc:"Micro-enterprise seed capital.", faction:"business", councilThreshold:3 },
  { id:"green_prog", name:"Urban Greening Program", emoji:"ğŸŒ³", cost:6000, monthly:700, effects:{ happiness:7, health:4, environment:10 }, bonus:{ environment:0.3 }, desc:"Tree planting and pocket parks.", faction:"civic", councilThreshold:3 },
  { id:"peace_order_council", name:"Peace & Order Council", emoji:"ğŸ¤", cost:7000, monthly:1400, effects:{ safety:10, happiness:5 }, bonus:{ safety:0.3 }, desc:"Community conflict mediation.", faction:"civic", councilThreshold:3 },
  { id:"philhealth_sub", name:"PhilHealth Subsidy", emoji:"ğŸ’Š", cost:8000, monthly:1600, effects:{ health:10, happiness:7 }, bonus:{ health:0.35 }, desc:"Universal health coverage.", faction:"seniors", councilThreshold:3 },
  { id:"transport", name:"Free Community Shuttle", emoji:"ğŸšŒ", cost:15000, monthly:2200, effects:{ employment:7, happiness:11, infrastructure:4 }, bonus:{ happiness:0.25 }, desc:"Free daily shuttle service.", faction:"business", councilThreshold:5 },
  { id:"night_patrol", name:"24/7 Night Watch", emoji:"ğŸ”¦", cost:6000, monthly:1500, effects:{ safety:14, happiness:6 }, bonus:{ safety:0.4 }, desc:"Round-the-clock tanod rotation.", faction:"civic", councilThreshold:3 },
  { id:"open_data", name:"Open Data & Transparency", emoji:"ğŸ“Š", cost:4000, monthly:500, effects:{ happiness:5 }, bonus:{ integrity_m:0.3 }, desc:"Publish all barangay transactions online.", faction:"civic", councilThreshold:4 },
  { id:"scholar_prog", name:"Youth Scholarship Expansion", emoji:"ğŸ“", cost:15000, monthly:3000, effects:{ education:16, happiness:10 }, bonus:{ education:0.5 }, desc:"Covers all grades 11-12 students.", faction:"youth", councilThreshold:5 },
  { id:"startup_grant", name:"Startup Micro-Grant", emoji:"ğŸš€", cost:12000, monthly:1500, effects:{ employment:12, happiness:8 }, bonus:{ employment:0.45 }, desc:"â‚±5K grants for first-time entrepreneurs.", faction:"business", councilThreshold:4 },
  { id:"business_permit", name:"Business Permit Reform", emoji:"ğŸ·ï¸", cost:5000, monthly:0, effects:{ employment:5, happiness:4, budget_monthly:1500 }, bonus:{ employment:0.2 }, desc:"Streamlined permits attract businesses.", faction:"business", councilThreshold:3 },
  { id:"env_ordinance", name:"Environmental Ordinance", emoji:"ğŸŒ", cost:6000, monthly:500, effects:{ environment:12, health:5 }, bonus:{ environment:0.35 }, desc:"Regulates pollution and illegal dumping.", faction:"civic", councilThreshold:4 },
];

// â”€â”€â”€ STAFF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STAFF_TYPES = [
  { id:"secretary", name:"Barangay Secretary", emoji:"ğŸ“‹", salary:8000, maxSlots:1, effect:{ deptAll:0.5 }, desc:"Improves all department efficiency." },
  { id:"health_worker", name:"Barangay Health Worker", emoji:"ğŸ©º", salary:6000, maxSlots:3, effect:{ stat:"health", bonus:1.5 }, desc:"Each BHW adds +1.5 health/month." },
  { id:"tanod", name:"Barangay Tanod", emoji:"ğŸ›¡ï¸", salary:4500, maxSlots:6, effect:{ stat:"safety", bonus:1.2, crimeR:2 }, desc:"Each tanod adds +1.2 safety and -2% crime/month." },
  { id:"teacher_aide", name:"Teacher's Aide", emoji:"ğŸ“", salary:5500, maxSlots:2, effect:{ stat:"education", bonus:1.5 }, desc:"Each aide adds +1.5 education/month." },
  { id:"engineer", name:"Barangay Engineer", emoji:"ğŸ”¨", salary:10000, maxSlots:1, effect:{ stat:"infrastructure", bonus:2, projSpeed:true }, desc:"Boosts infra and speeds up all projects." },
  { id:"livelihood_officer", name:"Livelihood Officer", emoji:"ğŸ’¼", salary:7000, maxSlots:1, effect:{ stat:"employment", bonus:2 }, desc:"Adds +2 employment/month." },
  { id:"youth_coordinator", name:"Youth Coordinator", emoji:"ğŸ¯", salary:6000, maxSlots:1, effect:{ stat:"happiness", bonus:1, crimeR:1.5 }, desc:"Youth programs reduce crime +boost happiness." },
];

// â”€â”€â”€ GRANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GRANTS = [
  { id:"dilg_seal", name:"DILG SGLG Grant", emoji:"ğŸ…", amount:80000, req:{ integrity:65, stats:{ safety:55, health:55 } }, desc:"Seal of Good Local Governance.", cooldown:36 },
  { id:"dswd_crisis", name:"DSWD Crisis Fund", emoji:"ğŸ¤²", amount:45000, req:{ integrity:50 }, desc:"Emergency social protection fund.", cooldown:12 },
  { id:"dpwh_road", name:"DPWH Road Grant", emoji:"ğŸ›£ï¸", amount:120000, req:{ integrity:55, stats:{ infrastructure:45 } }, desc:"National road improvement funding.", cooldown:24 },
  { id:"doh_health", name:"DOH Health Center Grant", emoji:"ğŸ¥", amount:90000, req:{ integrity:60, stats:{ health:50 } }, desc:"Health center funding.", cooldown:24 },
  { id:"deped_school", name:"DepEd School Building Grant", emoji:"ğŸ«", amount:150000, req:{ integrity:60, stats:{ education:45 } }, desc:"Fund for classrooms and facilities.", cooldown:36 },
  { id:"pcup_livelihood", name:"PCUP Livelihood Grant", emoji:"ğŸ’¼", amount:60000, req:{ integrity:55, stats:{ employment:40 } }, desc:"Informal sector livelihood programs.", cooldown:18 },
  { id:"denr_env", name:"DENR Environment Grant", emoji:"ğŸŒ", amount:70000, req:{ integrity:55, env:50 }, desc:"Eco-parks and clean water programs.", cooldown:18 },
];

// â”€â”€â”€ FACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const FACTIONS = [
  { id:"youth", name:"Youth Council", emoji:"ğŸ“", color:"#3b82f6", wants:["school","covered_court","youth_center","wifi_hub","scholar","scholar_prog"] },
  { id:"seniors", name:"Senior Citizens", emoji:"ğŸ‘´", color:"#f59e0b", wants:["health_center","senior_center","water_system","senior_aid","philhealth_sub"] },
  { id:"business", name:"Business Sector", emoji:"ğŸ’¼", color:"#10b981", wants:["market","road","livelihood","night_market","coop","business_permit","startup_grant"] },
  { id:"civic", name:"Civic & Church Leaders", emoji:"â›ª", color:"#8b5cf6", wants:["police_post","evacuation","garden","zero_waste","peace_order_council","open_data"] },
];

// â”€â”€â”€ ACHIEVEMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ACHIEVEMENTS = [
  { id:"first_build", name:"Builder", emoji:"ğŸ”¨", desc:"Build first facility", check:g=>Object.keys(g.buildings).length>=1 },
  { id:"five_builds", name:"Developer", emoji:"ğŸ—ï¸", desc:"Build 5 facilities", check:g=>Object.keys(g.buildings).length>=5 },
  { id:"ten_builds", name:"City Planner", emoji:"ğŸŒ†", desc:"Build 10 facilities", check:g=>Object.keys(g.buildings).length>=10 },
  { id:"all_builds", name:"Master Builder", emoji:"ğŸ™ï¸", desc:"Build all 25 facilities", check:g=>Object.keys(g.buildings).length>=25 },
  { id:"first_project", name:"Visionary", emoji:"ğŸ”­", desc:"Complete a major project", check:g=>g.completedProjects>=1 },
  { id:"healthy", name:"Healthy Barangay", emoji:"ğŸ’ª", desc:"Reach 80% Health", check:g=>g.stats.health>=80 },
  { id:"safe", name:"Safe Zone", emoji:"ğŸ›¡ï¸", desc:"Reach 80% Safety", check:g=>g.stats.safety>=80 },
  { id:"educated", name:"Smart Community", emoji:"ğŸ“š", desc:"Reach 80% Education", check:g=>g.stats.education>=80 },
  { id:"green", name:"Eco Champion", emoji:"ğŸŒ¿", desc:"Reach 80% Environment", check:g=>g.environment>=80 },
  { id:"crime_free", name:"Crime Free", emoji:"ğŸ”’", desc:"Crime rate below 10%", check:g=>g.crimeRate<10 },
  { id:"rich", name:"Fully Funded", emoji:"ğŸ’°", desc:"Accumulate â‚±1M budget", check:g=>g.budget>=1000000 },
  { id:"populated", name:"Growing City", emoji:"ğŸ‘¥", desc:"Reach 7,000 population", check:g=>g.population>=7000 },
  { id:"happy", name:"Maliwanag!", emoji:"ğŸŒŸ", desc:"Reach 90% Happiness", check:g=>g.stats.happiness>=90 },
  { id:"legislator", name:"Legislator", emoji:"ğŸ“œ", desc:"Pass 10 policies", check:g=>g.policies.length>=10 },
  { id:"integrity", name:"Incorruptible", emoji:"âš–ï¸", desc:"Maintain Integrity at 90+", check:g=>g.integrity>=90 },
  { id:"re_elected", name:"Re-Elected!", emoji:"ğŸ—³ï¸", desc:"Win a re-election", check:g=>g.terms>=2 },
  { id:"full_staff", name:"Full Cabinet", emoji:"ğŸ‘”", desc:"Hire 8+ staff members", check:g=>g.staffCount>=8 },
  { id:"missions5", name:"People's Servant", emoji:"ğŸ¤", desc:"Complete 5 resident missions", check:g=>g.missionsCompleted>=5 },
  { id:"council_pass", name:"Coalition Builder", emoji:"ğŸ›ï¸", desc:"Pass 5 ordinances through council", check:g=>g.councilPassed>=5 },
  { id:"all_zones", name:"All-Zone Governor", emoji:"ğŸ—ºï¸", desc:"Build in all 5 zones", check:g=>g.zonesBuilt>=5 },
  { id:"star_barangay", name:"Star Barangay!", emoji:"â­", desc:"Achieve Star Barangay tier", check:g=>g.tier>=5 },
];

const STAT_CFG = {
  health:{ emoji:"â¤ï¸", color:"#ef4444", label:"Health" },
  education:{ emoji:"ğŸ“š", color:"#3b82f6", label:"Education" },
  safety:{ emoji:"ğŸ›¡ï¸", color:"#f59e0b", label:"Safety" },
  infrastructure:{ emoji:"ğŸ”§", color:"#8b5cf6", label:"Infrastructure" },
  employment:{ emoji:"ğŸ’¼", color:"#10b981", label:"Employment" },
  happiness:{ emoji:"ğŸ˜Š", color:"#fbbf24", label:"Happiness" },
};

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fm(n) {
  const abs=Math.abs(n), s=n<0?"-":"";
  if(abs>=1e6) return `${s}â‚±${(abs/1e6).toFixed(2)}M`;
  if(abs>=1000) return `${s}â‚±${(abs/1000).toFixed(1)}K`;
  return `${s}â‚±${Math.round(abs)}`;
}
function cl(v,mn=0,mx=100){ return Math.max(mn,Math.min(mx,v)); }
function getTier(stats,env,pop,integrity,crime,factions){
  const avg=Object.values(stats).reduce((a,b)=>a+b,0)/6;
  const favg=Object.values(factions).reduce((a,b)=>a+b,0)/4;
  if(avg>=80&&env>=75&&pop>=7000&&integrity>=70&&crime<=15&&favg>=70) return 5;
  if(avg>=70&&env>=60&&pop>=5500&&integrity>=60&&crime<=25) return 4;
  if(avg>=58&&env>=45&&pop>=4000) return 3;
  if(avg>=42&&pop>=2500) return 2;
  return 1;
}
const TIER_NAMES=["","Sitio ğŸšï¸","Barangay ğŸ˜ï¸","Progressive Barangay ğŸŒ±","Model Barangay ğŸŒŸ","Star Barangay â­"];
const TIER_COLORS=["","#64748b","#3b82f6","#10b981","#f59e0b","#f97316"];

// â”€â”€â”€ COMPONENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SBar({ label, value, color, emoji, compact=false }) {
  const c=cl(value), gc=c>70?"#22c55e":c>40?"#f59e0b":"#ef4444";
  return (
    <div style={{ marginBottom:compact?5:8 }}>
      <div style={{ display:"flex", justifyContent:"space-between", marginBottom:2, fontSize:compact?10:11, fontFamily:"'IBM Plex Mono',monospace", color:"#7a8fa6" }}>
        <span>{emoji} {label}</span><span style={{ color:gc, fontWeight:700 }}>{Math.round(c)}%</span>
      </div>
      <div style={{ height:compact?4:5, background:"#1a2535", borderRadius:3, overflow:"hidden" }}>
        <div style={{ height:"100%", width:`${c}%`, background:color||gc, borderRadius:3, transition:"width 0.7s ease" }}/>
      </div>
    </div>
  );
}

function Ring({ value, max=100, size=50, sw=5, color="#22c55e", label }) {
  const r=(size-sw)/2, circ=2*Math.PI*r, pct=cl(value,0,max)/max;
  return (
    <div style={{ display:"flex", flexDirection:"column", alignItems:"center", gap:2 }}>
      <svg width={size} height={size} style={{ transform:"rotate(-90deg)" }}>
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke="#1a2535" strokeWidth={sw}/>
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={color} strokeWidth={sw} strokeDasharray={circ} strokeDashoffset={circ*(1-pct)} strokeLinecap="round" style={{ transition:"stroke-dashoffset 0.7s ease" }}/>
      </svg>
      <span style={{ fontSize:7, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", textAlign:"center" }}>{label}</span>
    </div>
  );
}

// â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function BarangaySim() {
  const [tab, setTab] = useState("dashboard");
  const [month, setMonth] = useState(0);
  const [year, setYear] = useState(2025);
  const [budget, setBudget] = useState(250000);
  const [population, setPopulation] = useState(3200);
  const [taxRate, setTaxRate] = useState(0.02);
  const [stats, setStats] = useState({ health:40, education:38, safety:38, infrastructure:32, employment:45, happiness:50 });
  const [environment, setEnvironment] = useState(45);
  const [integrity, setIntegrity] = useState(72);
  const [crimeRate, setCrimeRate] = useState(42);
  const [buildings, setBuildings] = useState({});
  const [activeProjects, setActiveProjects] = useState([]);
  const [completedProjects, setCompletedProjects] = useState(0);
  const [activePolicies, setActivePolicies] = useState([]);
  const [hiredStaff, setHiredStaff] = useState([]);
  const [loans, setLoans] = useState([]);
  const [loansRepaid, setLoansRepaid] = useState(0);
  const [usedGrants, setUsedGrants] = useState({});
  const [grantsSecured, setGrantsSecured] = useState(0);
  const [deptBudgets, setDeptBudgets] = useState({ health:5000, education:5000, safety:3000, infrastructure:4000, employment:3000 });
  const [factions, setFactions] = useState({ youth:48, seniors:50, business:44, civic:52, settlers:30 });
  const [achievements, setAchievements] = useState([]);
  const [log, setLog] = useState([{ month:"Jan 2025", text:`${kapitanName} is now Barangay Captain of ${barangayName}. Lead wisely!`, emoji:"ğŸ›ï¸", type:"info" }]);
  const [currentEvent, setCurrentEvent] = useState(null);
  const [showEvent, setShowEvent] = useState(false);
  const [gameOver, setGameOver] = useState(false);
  const [gameOverReason, setGameOverReason] = useState("");
  const [gameWin, setGameWin] = useState(false);
  const [electionPending, setElectionPending] = useState(false);
  const [electedTerms, setElectedTerms] = useState(1);
  const [electionsLost, setElectionsLost] = useState(0);
  const [toasts, setToasts] = useState([]);
  const [unhappyStreak, setUnhappyStreak] = useState(0);
  const [isMobile, setIsMobile] = useState(()=>typeof window!=="undefined"&&window.innerWidth<640);

  // New state for new systems
  const [activeMissions, setActiveMissions] = useState([]);
  const [completedMissions, setCompletedMissions] = useState([]);
  const [missionsCompleted, setMissionsCompleted] = useState(0);
  const [councilVote, setCouncilVote] = useState(null); // pending council vote item
  const [councilPassed, setCouncilPassed] = useState(0);
  const [councilLoyalties, setCouncilLoyalties] = useState(() => {
    const obj = {};
    COUNCIL_MEMBERS.forEach(m => { obj[m.id] = 50 + Math.floor(Math.random()*20); });
    return obj;
  });
  const [npcDialogue, setNpcDialogue] = useState(null); // { resident, message }
  const [newsItems, setNewsItems] = useState(["Welcome to Barangay Maunlad Management System","January 2025 â€” Your term begins","Build facilities, manage budget, serve your people"]);
  const [zonesBuilt, setZonesBuilt] = useState(new Set());
  const [buildingHealth, setBuildingHealth] = useState({}); // { buildingId: 0-100 }
  const [totalRepairs, setTotalRepairs] = useState(0);
  const [zone6Missions, setZone6Missions] = useState(0);
  const [demolitionPhase, setDemolitionPhase] = useState("pending"); // pending|notified|resolved
  const [showDemolitionModal, setShowDemolitionModal] = useState(false);
  const [kapitanName, setKapitanName] = useState("Kapitan");
  const [barangayName, setBarangayName] = useState("Barangay Maunlad");
  const [completedProjectIds, setCompletedProjectIds] = useState([]);
  const [tutorialDismissed, setTutorialDismissed] = useState(false);
  const [factionAngryWarned, setFactionAngryWarned] = useState({});
  const [confirmAction, setConfirmAction] = useState(null); // { label, cost, onConfirm }

  const toastRef = useRef(null);
  toastRef.current = (text, type="info") => {
    const id = Date.now()+Math.random();
    setToasts(p=>[...p.slice(-3),{id,text,type,out:false}]);
    setTimeout(()=>setToasts(p=>p.map(t=>t.id===id?{...t,out:true}:t)),3200);
    setTimeout(()=>setToasts(p=>p.filter(t=>t.id!==id)),3700);
  };

  useEffect(()=>{ const h=()=>setIsMobile(window.innerWidth<640); window.addEventListener("resize",h); return()=>window.removeEventListener("resize",h); },[]);

  // â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const totalDept = useMemo(()=>Object.values(deptBudgets).reduce((a,b)=>a+b,0),[deptBudgets]);
  const upkeep = useMemo(()=>Object.entries(buildings).reduce((s,[id,lvl])=>{ const b=BUILDINGS.find(x=>x.id===id); return s+(b?b.upkeep*(1+(lvl-1)*0.45):0); },0),[buildings]);
  const policyCost = useMemo(()=>activePolicies.reduce((s,pid)=>{ const p=POLICIES.find(x=>x.id===pid); return s+(p?p.monthly:0); },0),[activePolicies]);
  const staffCost = useMemo(()=>hiredStaff.reduce((s,h)=>{ const st=STAFF_TYPES.find(x=>x.id===h.type); return s+(st?st.salary:0); },0),[hiredStaff]);
  const loanCost = useMemo(()=>loans.reduce((s,l)=>s+l.monthly,0),[loans]);
  const marketIncome = useMemo(()=>{
    let inc=(buildings["market"]||0)*3000+(buildings["night_market"]||0)*1500+(buildings["coop"]||0)*2000;
    if(activePolicies.includes("business_permit")) inc+=1500;
    return inc;
  },[buildings,activePolicies]);
  const projectIncome = useMemo(()=>{
    let inc=0;
    PROJECTS.forEach(p=>{ if(completedProjectIds.includes(p.id)&&p.effects.budget_monthly) inc+=p.effects.budget_monthly; });
    return inc;
  },[completedProjectIds]);
  const income = useMemo(()=>22000+(electedTerms-1)*2500+Math.floor(population*taxRate*150)+marketIncome+projectIncome,[population,taxRate,marketIncome,electedTerms,projectIncome]);
  const mandatoryExpenses = 5000; // calamity fund â‚±3k + philhealth â‚±2k
  const netMonthly = income - upkeep - totalDept - policyCost - staffCost - loanCost - mandatoryExpenses;
  const totalMonths = (year-2025)*12+month;
  const nextElectionIn = 36-(totalMonths%36);
  const tier = useMemo(()=>getTier(stats,environment,population,integrity,crimeRate,factions),[stats,environment,population,integrity,crimeRate,factions]);
  const electionChance = useMemo(()=>{
    const hap=stats.happiness, favg=Object.values(factions).reduce((a,b)=>a+b,0)/4, intBonus=(integrity-50)/100;
    const chance=(hap/100)*0.5+(favg/100)*0.3+intBonus*0.2;
    return Math.round(Math.min(0.95,Math.max(0.05,chance))*100);
  },[stats.happiness,factions,integrity]);

  // â”€â”€ Save / Load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const saveGame = useCallback(async () => {
    const data = { tab,month,year,budget,population,buildingHealth,totalRepairs,zone6Missions,demolitionPhase,kapitanName,barangayName,taxRate,stats,environment,integrity,crimeRate,buildings,activeProjects,completedProjects,activePolicies,hiredStaff,loans,loansRepaid,usedGrants,grantsSecured,deptBudgets,factions,achievements,log:log.slice(0,20),electedTerms,electionsLost,unhappyStreak,activeMissions,completedMissions,missionsCompleted,councilPassed,councilLoyalties,zonesBuilt:[...zonesBuilt],newsItems,completedProjectIds,tutorialDismissed };
    try {
      localStorage.setItem("barangay_save_v2", JSON.stringify(data));
      toastRef.current("ğŸ’¾ Game saved!", "success");
    } catch(e) { toastRef.current("âŒ Save failed", "danger"); }
  }, [tab,month,year,budget,population,taxRate,stats,environment,integrity,crimeRate,buildings,activeProjects,completedProjects,activePolicies,hiredStaff,loans,loansRepaid,usedGrants,grantsSecured,deptBudgets,factions,achievements,log,electedTerms,electionsLost,unhappyStreak,activeMissions,completedMissions,missionsCompleted,councilPassed,councilLoyalties,zonesBuilt,newsItems,completedProjectIds,tutorialDismissed]);

  const loadGame = useCallback(async () => {
    try {
      const rawV2 = localStorage.getItem("barangay_save_v2");
      const rawV1 = localStorage.getItem("barangay_save");
      const rawData = rawV2 || rawV1;
      if(!rawV2 && rawV1) setTimeout(()=>toastRef.current("ğŸ“¦ V1 save migrated!","gold"),500);
      const res = rawData ? { value: rawData } : null;
      if (!res) { toastRef.current("No save found.", "warning"); return; }
      const d = JSON.parse(res.value);
      setTab(d.tab||"dashboard"); setMonth(d.month||0); setYear(d.year||2025); setBudget(d.budget||250000); setPopulation(d.population||3200); setTaxRate(d.taxRate||0.02); setStats(d.stats||{}); setEnvironment(d.environment||45); setIntegrity(d.integrity||72); setCrimeRate(d.crimeRate||42); setBuildings(d.buildings||{}); setBuildingHealth(d.buildingHealth||{}); setTotalRepairs(d.totalRepairs||0); setZone6Missions(d.zone6Missions||0); setDemolitionPhase(d.demolitionPhase||"pending"); if(d.kapitanName) setKapitanName(d.kapitanName); if(d.barangayName) setBarangayName(d.barangayName); setActiveProjects(d.activeProjects||[]); setCompletedProjects(d.completedProjects||0); setActivePolicies(d.activePolicies||[]); setHiredStaff(d.hiredStaff||[]); setLoans(d.loans||[]); setLoansRepaid(d.loansRepaid||0); setUsedGrants(d.usedGrants||{}); setGrantsSecured(d.grantsSecured||0); setDeptBudgets(d.deptBudgets||{}); setFactions(d.factions||{}); setAchievements(d.achievements||[]); setLog(d.log||[]); setElectedTerms(d.electedTerms||1); setElectionsLost(d.electionsLost||0); setUnhappyStreak(d.unhappyStreak||0); setActiveMissions(d.activeMissions||[]); setCompletedMissions(d.completedMissions||[]); setMissionsCompleted(d.missionsCompleted||0); setCouncilPassed(d.councilPassed||0); setCouncilLoyalties(d.councilLoyalties||{}); setZonesBuilt(new Set(d.zonesBuilt||[])); setNewsItems(d.newsItems||[]); setCompletedProjectIds(d.completedProjectIds||[]); if(d.tutorialDismissed) setTutorialDismissed(true);
      toastRef.current("âœ… Game loaded!", "success");
    } catch(e) { toastRef.current("No save found.", "warning"); }
  }, []);

  const newGame = useCallback(async () => {
    try { localStorage.removeItem("barangay_save_v2"); localStorage.removeItem("barangay_save"); } catch(e) {}
    setTab("dashboard"); setMonth(0); setYear(2025); setBudget(250000); setPopulation(3200); setTaxRate(0.02);
    setStats({ health:40, education:38, safety:38, infrastructure:32, employment:45, happiness:50 });
    setEnvironment(45); setIntegrity(72); setCrimeRate(42); setBuildings({}); setActiveProjects([]); setCompletedProjects(0);
    setActivePolicies([]); setHiredStaff([]); setLoans([]); setLoansRepaid(0); setUsedGrants({}); setGrantsSecured(0);
    setDeptBudgets({ health:5000, education:5000, safety:3000, infrastructure:4000, employment:3000 });
    setFactions({ youth:48, seniors:50, business:44, civic:52, settlers:30 }); setAchievements([]);
    setLog([{ month:"Jan 2025", text:`${kapitanName} is now Barangay Captain of ${barangayName}. Lead wisely!`, emoji:"ğŸ›ï¸", type:"info" }]);
    setGameOver(false); setGameOverReason(""); setGameWin(false); setElectionPending(false); setElectedTerms(1); setElectionsLost(0);
    setUnhappyStreak(0); setActiveMissions([]); setCompletedMissions([]); setMissionsCompleted(0); setCouncilPassed(0);
    setCouncilLoyalties(()=>{ const obj={}; COUNCIL_MEMBERS.forEach(m=>{ obj[m.id]=50+Math.floor(Math.random()*20); }); return obj; });
    setZonesBuilt(new Set()); setNewsItems(["Welcome to Barangay Maunlad Management System","January 2025 â€” Your term begins","Build facilities, manage budget, serve your people"]);
    setCompletedProjectIds([]); setTutorialDismissed(false); setFactionAngryWarned({}); setConfirmAction(null);
  }, []);

  // Auto-save every 3 months (use ref to avoid stale closure)
  const saveGameRef = useRef(saveGame);
  useEffect(()=>{ saveGameRef.current=saveGame; },[saveGame]);
  useEffect(()=>{ if(totalMonths>0&&totalMonths%3===0) saveGameRef.current(); },[totalMonths]);

  // â”€â”€ Achievement check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const addLog = useCallback((text,type="info",emoji=null,m=month,y=year)=>{
    const em=emoji||(type==="success"?"âœ…":type==="danger"?"ğŸš¨":type==="warning"?"âš ï¸":type==="gold"?"ğŸ†":"ğŸ“‹");
    setLog(p=>[{month:`${SM[m]} ${y}`,text,emoji:em,type},...p.slice(0,79)]);
  },[month,year]);

  useEffect(()=>{
    const gs={buildings,stats,budget,population,policies:activePolicies,terms:electedTerms,integrity,crimeRate,environment,factions,completedProjects,loansRepaid,grantsSecured,staffCount:hiredStaff.length,tier,missionsCompleted,councilPassed,zonesBuilt:zonesBuilt.size};
    const newOnes=ACHIEVEMENTS.filter(a=>!achievements.includes(a.id)&&a.check(gs));
    if(newOnes.length){ setAchievements(p=>[...p,...newOnes.map(a=>a.id)]); newOnes.forEach(a=>{ toastRef.current(`ğŸ† ${a.name}!`,"gold"); addLog(`Achievement: ${a.name} ${a.emoji}`,"gold"); }); }
  },[buildings,stats,budget,population,activePolicies,electedTerms,integrity,crimeRate,environment,factions,completedProjects,loansRepaid,grantsSecured,hiredStaff.length,tier,missionsCompleted,councilPassed,zonesBuilt]);

  useEffect(()=>{ if(gameOver||gameWin||electionPending) return; if(tier>=5) setGameWin(true); },[tier]);

  // â”€â”€ Faction anger warnings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  useEffect(()=>{
    if(totalMonths===0) return;
    FACTIONS.forEach(f=>{
      const sat=factions[f.id];
      if(sat<35&&!factionAngryWarned[f.id]){
        toastRef.current(`âš ï¸ ${f.emoji} ${f.name} is furious! (${Math.round(sat)}%)`, "danger");
        setFactionAngryWarned(p=>({...p,[f.id]:true}));
      } else if(sat>=40&&factionAngryWarned[f.id]){
        setFactionAngryWarned(p=>({...p,[f.id]:false}));
      }
    });
  },[factions]);

  // â”€â”€ Mission spawning â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  useEffect(()=>{
    if(activeMissions.length>=3) return;
    const used=[...activeMissions.map(m=>m.id),...completedMissions];
    let available=MISSION_POOL.filter(m=>!used.includes(m.id));
    // If pool is exhausted, recycle completed missions (except currently active)
    if(!available.length){
      const activeIds=activeMissions.map(m=>m.id);
      available=MISSION_POOL.filter(m=>!activeIds.includes(m.id));
      if(!available.length) return;
      // Notify player
      if(completedMissions.length>=MISSION_POOL.length) setNewsItems(p=>["ğŸ“‹ New resident requests have come in â€” help your community again!", ...p.slice(0,4)]);
    }
    const pick=available[Math.floor(Math.random()*available.length)];
    setActiveMissions(p=>[...p,{...pick,monthsLeft:pick.deadline}]);
    // Show NPC dialogue
    const res=RESIDENTS.find(r=>r.id===pick.from);
    if(res) {
      const msg=res.dialogue[Math.floor(Math.random()*res.dialogue.length)];
      setNpcDialogue({resident:res,message:msg,mission:pick});
      const news=`${res.emoji} ${res.name}: "${msg.slice(0,40)}..."`;
      setNewsItems(p=>[news,...p.slice(0,4)]);
    }
  },[totalMonths]);

  // â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const repairBuilding = (bId) => {
    const b=BUILDINGS.find(x=>x.id===bId);
    if(!b||!buildings[bId]) return;
    const health=buildingHealth[bId]??100;
    const repairCost=Math.round(b.cost*0.18*(1-health/100))+2500;
    if(budget<repairCost){ toastRef.current(`âŒ Need ${fm(repairCost)} to repair.`,"danger"); return; }
    setBudget(p=>p-repairCost);
    setBuildingHealth(p=>({...p,[bId]:100}));
    setTotalRepairs(r=>r+1);
    addLog(`Repaired: ${b.name} restored to 100% ${b.emoji}`,"success");
    toastRef.current(`ğŸ”§ ${b.name} repaired!`,"success");
  };

  const buildFacility = (b) => {
    if(budget<b.cost||buildings[b.id]) return;
    const doBuild = () => {
      if(b.bldMonths>1){
        if(activeProjects.find(p=>p.id===b.id)) return;
        setBudget(p=>p-b.cost);
        setActiveProjects(p=>[...p,{...b,monthsLeft:b.bldMonths,isBuilding:true}]);
        addLog(`Construction started: ${b.name} (${b.bldMonths} mo) ${b.emoji}`,"info");
        toastRef.current(`ğŸ—ï¸ Building ${b.name}â€¦`,"info");
      } else {
        setBudget(p=>p-b.cost);
        setBuildings(p=>({...p,[b.id]:1}));
        setStats(p=>{ const n={...p}; Object.entries(b.effects).forEach(([k,v])=>{ if(k!=="budget_monthly"&&n[k]!==undefined) n[k]=cl(n[k]+v); }); return n; });
        setZonesBuilt(p=>new Set([...p,b.zone]));
        addLog(`Built: ${b.name} ${b.emoji}`,"success");
        toastRef.current(`${b.emoji} ${b.name} built!`,"success");
      }
    };
    if(b.cost>=50000){
      setConfirmAction({ label:`Build ${b.name}`, cost:b.cost, onConfirm:doBuild });
      return;
    }
    doBuild();
  };

  const upgradeBuilding = (b) => {
    const lvl=buildings[b.id]||0;
    if(!lvl||lvl>=b.maxLvl||budget<b.upgCost) return;
    setBudget(p=>p-b.upgCost);
    setBuildings(p=>({...p,[b.id]:lvl+1}));
    setStats(p=>{ const n={...p}; Object.entries(b.effects).forEach(([k,v])=>{ if(k!=="budget_monthly"&&n[k]!==undefined) n[k]=cl(n[k]+Math.floor(v*0.5)); }); return n; });
    addLog(`Upgraded ${b.name} â†’ L${lvl+1} ${b.emoji}`,"success");
    toastRef.current(`â¬†ï¸ ${b.name} L${lvl+1}!`,"success");
  };

  const startProject = (proj) => {
    if(budget<proj.cost||activeProjects.find(p=>p.id===proj.id)||completedProjectIds.includes(proj.id)) return;
    if(proj.cost>=50000){
      setConfirmAction({ label:`Start ${proj.name}`, cost:proj.cost, onConfirm:()=>{
        setBudget(p=>p-proj.cost);
        setActiveProjects(p=>[...p,{...proj,monthsLeft:proj.months,isBuilding:false}]);
        addLog(`Major project started: ${proj.name} (${proj.months} mo) ${proj.emoji}`,"info");
        toastRef.current(`ğŸš§ ${proj.name} underway!`,"info");
      }});
      return;
    }
    setBudget(p=>p-proj.cost);
    setActiveProjects(p=>[...p,{...proj,monthsLeft:proj.months,isBuilding:false}]);
    addLog(`Major project started: ${proj.name} (${proj.months} mo) ${proj.emoji}`,"info");
    toastRef.current(`ğŸš§ ${proj.name} underway!`,"info");
  };

  const proposeToCouncil = (pol) => {
    if(activePolicies.includes(pol.id)) return;
    setCouncilVote({ type:"policy", item:pol });
  };

  const resolveCouncilVote = (approve) => {
    if(!councilVote) return;
    if(approve) {
      const pol=councilVote.item;
      if(budget<pol.cost) { toastRef.current("âŒ Not enough budget after council approval.", "danger"); setCouncilVote(null); return; }
      setBudget(p=>p-pol.cost);
      setActivePolicies(p=>[...p,pol.id]);
      setStats(p=>{ const n={...p}; Object.entries(pol.effects).forEach(([k,v])=>{ if(n[k]!==undefined) n[k]=cl(n[k]+v); }); return n; });
      const fac=FACTIONS.find(f=>f.id===pol.faction);
      if(fac) setFactions(p=>({...p,[pol.faction]:cl(p[pol.faction]+10)}));
      setCouncilPassed(c=>c+1);
      addLog(`Ordinance passed: ${pol.name} ${pol.emoji}`,"success");
      toastRef.current(`ğŸ“œ ${pol.name} enacted!`,"success");
      // Update council loyalties for those who agreed
      const newLoyalties={...councilLoyalties};
      COUNCIL_MEMBERS.forEach(m=>{ if(m.faction===pol.faction) newLoyalties[m.id]=cl(newLoyalties[m.id]+5); });
      setCouncilLoyalties(newLoyalties);
    } else {
      addLog(`Council rejected: ${councilVote.item.name}`,"warning");
      toastRef.current(`âŒ Proposal rejected by council.`,"warning");
    }
    setCouncilVote(null);
  };

  const completeMission = (mission) => {
    if(mission.cost && budget<mission.cost) { toastRef.current("âŒ Not enough budget for this mission.","danger"); return; }
    if(mission.requirement?.building && !buildings[mission.requirement.building]) { toastRef.current("âŒ Required building not built yet.","danger"); return; }
    if(mission.cost) setBudget(p=>p-mission.cost);
    setStats(p=>{ const n={...p}; Object.entries(mission.reward).forEach(([k,v])=>{ if(n[k]!==undefined) n[k]=cl(n[k]+v); }); return n; });
    if(mission.reward.faction) setFactions(p=>({...p,[mission.reward.faction]:cl(p[mission.reward.faction]+(mission.reward.factionBoost||5))}));
    if(mission.reward.budget) setBudget(p=>p+mission.reward.budget);
    setActiveMissions(p=>p.filter(m=>m.id!==mission.id));
    setCompletedMissions(p=>[...p,mission.id]);
    setMissionsCompleted(c=>c+1);
    const mRes=RESIDENTS.find(r=>r.id===mission.from);
    if(mRes&&mRes.zone==="settlers") setZone6Missions(c=>c+1);
    addLog(`Mission complete: ${mission.title} ${mission.emoji}`,"success");
    toastRef.current(`âœ… Mission: ${mission.title} done!`,"gold");
    // NPC thanks
    const res=RESIDENTS.find(r=>r.id===mission.from);
    if(res) { setNewsItems(p=>[`${res.emoji} ${res.name} thanks the Kapitan for completing: ${mission.title}`, ...p.slice(0,4)]); }
  };

  const dismissMission = (missionId) => {
    setActiveMissions(p=>p.filter(m=>m.id!==missionId));
    setIntegrity(i=>cl(i-3));
  };

  const takeLoan = (amount, months) => {
    if(loans.length>0) { toastRef.current("âŒ Pay existing loan first.","danger"); return; }
    const rate = amount>=500000?0.12:amount>=250000?0.10:0.08;
    const monthly=Math.floor(amount*(1+rate)/months);
    setLoans(p=>[...p,{ id:Date.now(), principal:amount, monthly, remaining:months, totalMonths:months }]);
    setBudget(p=>p+amount);
    addLog(`Loan: ${fm(amount)} at ${(rate*100).toFixed(0)}%, ${months} months. Monthly: ${fm(monthly)}`,"warning");
    toastRef.current(`ğŸ’³ Loan: ${fm(amount)}`,"warning");
  };

  const repayLoanEarly = (loan) => {
    const total=loan.monthly*loan.remaining;
    if(budget<total){ toastRef.current("âŒ Not enough budget to repay early.","danger"); return; }
    setBudget(p=>p-total);
    setLoans(p=>p.filter(l=>l.id!==loan.id));
    setLoansRepaid(r=>r+1);
    setIntegrity(i=>cl(i+2));
    addLog(`Early loan repayment: ${fm(loan.principal)} fully cleared! +2 integrity.`,"success","ğŸ’³");
    toastRef.current("ğŸ’³ Loan repaid early! +2 Integrity","success");
  };

  const applyGrant = (grant) => {
    const last=usedGrants[grant.id];
    if(last&&totalMonths-last<grant.cooldown) return;
    const intOk=integrity>=(grant.req.integrity||0);
    const statsOk=!grant.req.stats||Object.entries(grant.req.stats).every(([k,v])=>stats[k]>=v);
    const envOk=!grant.req.env||environment>=grant.req.env;
    if(!intOk||!statsOk||!envOk){ toastRef.current("âŒ Requirements not met.","danger"); return; }
    const chance=0.45+(integrity/100)*0.45;
    setUsedGrants(p=>({...p,[grant.id]:totalMonths}));
    if(Math.random()<chance){ setBudget(p=>p+grant.amount); setGrantsSecured(c=>c+1); addLog(`Grant approved: ${grant.name} +${fm(grant.amount)} ${grant.emoji}`,"success"); toastRef.current(`${grant.emoji} ${grant.name} approved!`,"gold"); }
    else{ addLog(`Grant rejected: ${grant.name}. Improve integrity and retry.`,"warning"); toastRef.current(`âŒ Grant rejected`,"warning"); }
  };

  const handleEventChoice = (choice) => {
    Object.entries(choice.effects).forEach(([k,v])=>{
      if(k==="budget") setBudget(b=>b+v);
      else if(k==="integrity") setIntegrity(i=>cl(i+v));
      else if(k==="environment") setEnvironment(e=>cl(e+v));
    });
    setStats(p=>{ const n={...p}; Object.entries(choice.effects).forEach(([k,v])=>{ if(n[k]!==undefined) n[k]=cl(n[k]+v); }); return n; });
    addLog(`Decision: "${choice.label}"`,(choice.effects.happiness||0)>=0?"success":"warning",currentEvent.emoji);
    setNewsItems(p=>[`${currentEvent.emoji} ${currentEvent.name}: Kapitan chose "${choice.label}"`, ...p.slice(0,4)]);
    setShowEvent(false); setCurrentEvent(null);
  };

  const handleGoodEvent = () => {
    const ev=currentEvent;
    Object.entries(ev.effects).forEach(([k,v])=>{ if(k==="budget") setBudget(b=>b+v); else if(k==="integrity") setIntegrity(i=>cl(i+v)); else if(k==="environment") setEnvironment(e=>cl(e+v)); });
    setStats(p=>{ const n={...p}; Object.entries(ev.effects).forEach(([k,v])=>{ if(n[k]!==undefined) n[k]=cl(n[k]+v); }); return n; });
    addLog(`${ev.name}: ${ev.desc}`,"info",ev.emoji);
    setNewsItems(p=>[`${ev.emoji} ${ev.name}!`, ...p.slice(0,4)]);
    setShowEvent(false); setCurrentEvent(null);
  };

  const handleDemolitionChoice = (choice) => {
    setDemolitionPhase("resolved"); setShowDemolitionModal(false);
    if(choice==="fight"){
      setBudget(p=>p-15000); setFactions(f=>({...f,settlers:Math.min(100,(f.settlers||30)+20)})); setIntegrity(i=>Math.min(100,i+5)); setStats(p=>({...p,happiness:Math.min(100,p.happiness+8)}));
      addLog("Fought the demolition order legally! Zone 6 cheers!","success","âš–ï¸"); toastRef.current("âš–ï¸ You stood up for Zone 6! +20 settler trust","gold");
    } else if(choice==="relocate"){
      setBudget(p=>p-30000); setFactions(f=>({...f,settlers:Math.min(100,(f.settlers||30)+8)})); setStats(p=>({...p,happiness:Math.min(100,p.happiness+3)}));
      addLog("Facilitated orderly relocation with aid packages.","success","ğŸ˜ï¸"); toastRef.current("ğŸ˜ï¸ Relocation facilitated with aid packages","success");
    } else {
      setFactions(f=>({...f,settlers:Math.max(0,(f.settlers||30)-15)})); setIntegrity(i=>Math.max(0,i-8)); setStats(p=>({...p,happiness:Math.max(0,p.happiness-10)}));
      addLog("Ignored Zone 6. Residents are devastated.","danger","ğŸ˜¢"); toastRef.current("ğŸ˜¢ Zone 6 ignored. Major trust and integrity loss.","danger");
    }
  };

  const handleElection = (run) => {
    if(!run){ setElectionPending(false); addLog("Stepped down from re-election.","info","ğŸšª"); return; }
    const hap=stats.happiness, favg=Object.values(factions).reduce((a,b)=>a+b,0)/4, intBonus=(integrity-50)/100;
    const chance=(hap/100)*0.5+(favg/100)*0.3+intBonus*0.2;
    if(chance>0.42+Math.random()*0.2){ setElectedTerms(t=>t+1); setElectionPending(false); addLog(`Re-elected! Term ${electedTerms+1} begins.`,"success","ğŸ—³ï¸"); toastRef.current(`ğŸ—³ï¸ Re-elected for Term ${electedTerms+1}!`,"gold"); }
    else{ const lost=electionsLost+1; setElectionsLost(lost); if(lost>=2){ setGameOverReason("You lost two consecutive elections. The people have chosen new leadership."); setGameOver(true); } else{ setElectionPending(false); addLog("Lost the election! One more loss ends your career.","danger","ğŸ—³ï¸"); toastRef.current("âŒ Election lost! One more chance.","danger"); } }
  };

  // â”€â”€ Advance Month â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const advanceMonth = () => {
    if(showEvent||electionPending||councilVote||gameOver||gameWin||confirmAction) return;
    const cm=month, cy=year;
    const newBudget=budget+netMonthly;
    setBudget(newBudget);

    // Tick loans
    setLoans(p=>{
      const next=p.map(l=>({...l,remaining:l.remaining-1})).filter(l=>{ if(l.remaining<=0){ setLoansRepaid(r=>r+1); addLog(`Loan fully repaid! ${fm(l.principal)} cleared.`,"success","ğŸ’³",cm,cy); return false; } return true; }); return next;
    });

    // Tick projects
    setActiveProjects(p=>{
      const next=[];
      p.forEach(proj=>{
        const rem=proj.monthsLeft-1;
        if(rem<=0){
          if(proj.isBuilding){ setBuildings(b=>({...b,[proj.id]:1})); setStats(s=>{ const n={...s}; Object.entries(proj.effects||{}).forEach(([k,v])=>{ if(k!=="budget_monthly"&&n[k]!==undefined) n[k]=cl(n[k]+v); }); return n; }); if(proj.zone) setZonesBuilt(z=>new Set([...z,proj.zone])); }
          else{ setCompletedProjects(c=>c+1); setCompletedProjectIds(p=>[...p,proj.id]); setStats(s=>{ const n={...s}; Object.entries(proj.effects||{}).forEach(([k,v])=>{ if(k!=="budget_monthly"&&n[k]!==undefined) n[k]=cl(n[k]+v); }); return n; }); if((proj.effects||{}).environment) setEnvironment(e=>cl(e+(proj.effects.environment||0))); }
          addLog(`âœ… Complete: ${proj.name}! ${proj.emoji}`,"success",null,cm,cy); toastRef.current(`ğŸ‰ ${proj.name} complete!`,"gold");
        } else { next.push({...proj,monthsLeft:rem}); }
      });
      return next;
    });

    // Tick mission deadlines
    setActiveMissions(p=>{
      const next=p.map(m=>({...m,monthsLeft:(m.monthsLeft||m.deadline)-1}));
      next.filter(m=>m.monthsLeft<=0).forEach(m=>{ addLog(`Mission expired: ${m.title}. Residents are disappointed.`,"warning","â°",cm,cy); setIntegrity(i=>cl(i-2)); setFactions(f=>({...f,[m.reward?.faction||"civic"]:cl(f[m.reward?.faction||"civic"]-5)})); });
      return next.filter(m=>m.monthsLeft>0);
    });

    // Stats update
    setStats(prev=>{
      const n={...prev};
      Object.entries(deptBudgets).forEach(([dept,spend])=>{ const boost=spend>8000?3.5:spend>5000?2:spend>2000?0.8:spend>0?0.2:-1; n[dept]=cl(n[dept]+boost); });
      hiredStaff.forEach(s=>{ const st=STAFF_TYPES.find(x=>x.id===s.type); if(!st) return; if(st.effect.stat&&n[st.effect.stat]!==undefined) n[st.effect.stat]=cl(n[st.effect.stat]+(st.effect.bonus||0)); if(st.id==="secretary") Object.keys(n).forEach(k=>{ n[k]=cl(n[k]+0.3); }); });
      activePolicies.forEach(pid=>{ const p=POLICIES.find(x=>x.id===pid); if(p?.bonus) Object.entries(p.bonus).forEach(([k,v])=>{ if(k!=="integrity_m"&&n[k]!==undefined) n[k]=cl(n[k]+v); }); });
      Object.keys(n).forEach(k=>{ n[k]=Math.max(0,n[k]-0.15); });
      if(taxRate>0.05) n.happiness=cl(n.happiness-3);
      if(taxRate>0.07) n.happiness=cl(n.happiness-2);
      if(integrity<40) n.happiness=cl(n.happiness-1.5);
      const otherAvg=(n.health+n.safety+n.education+n.infrastructure+n.employment)/5;
      const hapBoost=netMonthly>10000?1:netMonthly>0?0.3:-1;
      n.happiness=cl(n.happiness*0.65+otherAvg*0.3+hapBoost);
      return n;
    });

    // Building decay
    setBuildingHealth(prev=>{
      const next={...prev};
      Object.keys(buildings).forEach(bId=>{
        const b=BUILDINGS.find(x=>x.id===bId); if(!b) return;
        const h=prev[bId]??100;
        const decay=b.cat==="safety"?4:b.cat==="infra"?3:2;
        next[bId]=Math.max(0,h-decay);
        if(h>=20&&next[bId]<20) setTimeout(()=>toastRef.current(`ğŸ”´ ${b.name} is now BROKEN! Repair needed.`,"danger"),300);
        else if(h>=50&&next[bId]<50) setTimeout(()=>toastRef.current(`âš ï¸ ${b.name} needs maintenance (${Math.round(next[bId])}%)!`,"warning"),300);
      });
      return next;
    });
    // Crime rate
    setCrimeRate(p=>{
      let c=p+(stats.safety>70?-2:stats.safety>50?-0.5:stats.safety>30?0.3:1.5);
      c-=hiredStaff.filter(s=>s.type==="tanod").length*2;
      if(buildings["cctv"]) c-=(buildings["cctv"])*1.5;
      if(buildings["police_post"]) c-=1;
      if(buildings["youth_center"]) c-=0.8;
      if(activePolicies.includes("night_patrol")) c-=0.8;
      c+=Math.random()*0.8-0.3;
      return cl(c,0,100);
    });

    // Environment
    setEnvironment(p=>{
      let e=p-0.2;
      if(buildings["garden"]) e+=0.3; if(buildings["eco_park"]) e+=0.5; if(buildings["waste_facility"]) e+=0.6; if(buildings["drainage"]) e+=0.2;
      if(activePolicies.includes("zero_waste")) e+=0.3; if(activePolicies.includes("env_ordinance")) e+=0.35; if(activePolicies.includes("green_prog")) e+=0.3;
      return cl(e);
    });

    // Integrity
    setIntegrity(p=>{ let i=p; if(activePolicies.includes("open_data")) i+=0.3; return cl(Math.max(0,i-0.05)); });

    // Population
    setPopulation(p=>Math.max(500,p+(stats.happiness>75?25:stats.happiness>60?12:stats.happiness>45?4:stats.happiness>30?-3:-15)));

    // Factions
    setFactions(p=>{
      const n={...p};
      n.youth=cl(n.youth+(stats.education>60?0.5:-0.3)+(buildings["youth_center"]?0.3:0)+(activePolicies.includes("scholar")?0.4:0));
      n.seniors=cl(n.seniors+(stats.health>60?0.5:-0.3)+(buildings["senior_center"]?0.4:0)+(activePolicies.includes("senior_aid")?0.5:0));
      n.business=cl(n.business+(stats.employment>60?0.5:-0.3)+(buildings["market"]?0.3:0)+(activePolicies.includes("business_permit")?0.4:0));
      n.civic=cl(n.civic+(stats.safety>55?0.4:-0.2)+(environment>55?0.3:-0.2)+(integrity>65?0.3:-0.3)+(activePolicies.includes("open_data")?0.3:0));
      const socialWorkers=hiredStaff.filter(s=>s.type==="social_worker").length;
      n.settlers=cl((n.settlers||30)+(buildings["health_center"]?0.4:0)+(buildings["legal_aid"]?0.5:0)+(socialWorkers*0.6)+(demolitionPhase==="resolved"?0.5:demolitionPhase==="notified"?-0.3:-0.1));
      Object.keys(n).forEach(k=>{ n[k]=n[k]+(n[k]>50?-0.1:0.1); });
      return n;
    });

    // Game over checks
    const hap=stats.happiness;
    if(hap<15){ const ns=unhappyStreak+1; setUnhappyStreak(ns); if(ns>=3){ setGameOverReason("Residents have been in crisis for 3 months. They lost faith in your leadership."); setGameOver(true); return; } } else setUnhappyStreak(0);
    if(newBudget<-75000){ setGameOverReason("Barangay went bankrupt. Deficit exceeded â‚±75,000."); setGameOver(true); return; }
    if(integrity<=0){ setGameOverReason("Integrity reached zero. Ombudsman filed charges against you."); setGameOver(true); return; }
    if((factions.settlers||30)<8&&demolitionPhase!=="resolved"){ setGameOverReason("Zone 6 settlers organized a massive protest and a No-Confidence vote removed you from office."); setGameOver(true); return; }

    // Advance time
    const nm=(cm+1)%12, ny=cm===11?cy+1:cy;
    setMonth(nm); setYear(ny);
    addLog(`${MONTHS[cm]} ended. Net: ${fm(netMonthly)}`,netMonthly>=0?"success":"warning",null,cm,cy);

    // Annual COA in December
    if(cm===11){ if(integrity<50){ const fine=Math.floor(budget*0.05); setBudget(b=>b-fine); addLog(`âš–ï¸ COA audit issues found. Fine: ${fm(fine)}`,"danger",null,cm,cy); setIntegrity(i=>cl(i-5)); } else addLog(`âœ… COA annual audit passed!`,"success",null,cm,cy); }

    // Random event
    const season=getSeason(cm);
    const pool=EVENTS.filter(e=>e.season===null||e.season===season).flatMap(e=>Array(e.weight||1).fill(e));
    if(Math.random()<(season===1?0.45:0.32)){ const ev=pool[Math.floor(Math.random()*pool.length)]; setCurrentEvent(ev); setShowEvent(true); }

    // Election
    const newTotal=(ny-2025)*12+nm;
    if(newTotal>0&&newTotal%36===0) setElectionPending(true);
    // Zone 6 demolition notice at Month 3
    if(newTotal===3&&demolitionPhase==="pending"){ setDemolitionPhase("notified"); setShowDemolitionModal(true); addLog("âš ï¸ City demolition order arrived for Zone 6! Respond urgently.","danger","ğŸšï¸",nm,ny); toastRef.current("ğŸšï¸ URGENT: Zone 6 Demolition Order!","danger"); }
    // Zone 6 passive tension if unresolved
    if(demolitionPhase==="notified") setFactions(f=>({...f,settlers:Math.max(5,f.settlers-0.5)}));
  };

  // â”€â”€ Council vote simulation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const getCouncilVoteResult = (pol) => {
    const votes = COUNCIL_MEMBERS.map(m=>{
      const loyalty = councilLoyalties[m.id]||50;
      const factionBonus = m.faction===pol.faction ? 25 : 0;
      const factionSat = factions[m.faction]||50;
      const voteChance = (loyalty+factionBonus+factionSat)/200;
      const votes = Math.random() < voteChance;
      return { member:m, votes };
    });
    const yeas = votes.filter(v=>v.votes).length;
    return { votes, yeas, passes: yeas >= pol.councilThreshold };
  };

  // â”€â”€ Derived UI values â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const M=isMobile;
  const hap=stats.happiness;
  const hapLabel=hap>85?"Napakasaya! ğŸ¥³":hap>70?"Masaya ğŸ˜„":hap>55?"Content ğŸ™‚":hap>40?"Neutral ğŸ˜":hap>25?"Unhappy ğŸ˜Ÿ":"Angry ğŸ˜¡";
  const budgetColor=budget>100000?"#22c55e":budget>0?"#f59e0b":"#ef4444";

  const S={
    root:{ fontFamily:"'Syne',sans-serif", background:"#060b14", minHeight:"100vh", color:"#dde6f0", maxWidth:920, margin:"0 auto", paddingBottom:M?70:40 },
    header:{ background:"linear-gradient(135deg,#081a10,#061210,#04090f)", borderBottom:"1px solid #0c2a1c", padding:M?"12px 14px":"16px 22px" },
    ticker:{ background:"#040810", borderBottom:"1px solid #0c1e30", padding:"5px 0", overflow:"hidden", whiteSpace:"nowrap" },
    tabs:{ display:"flex", background:"#070e1c", borderBottom:"1px solid #0c1e30", overflowX:"auto" },
    tab:(a)=>({ padding:M?"9px 10px":"10px 16px", fontSize:M?10:11, fontWeight:700, cursor:"pointer", color:a?"#34d399":"#2d4055", borderBottom:a?"2px solid #34d399":"2px solid transparent", whiteSpace:"nowrap", letterSpacing:0.5, transition:"color 0.2s" }),
    content:{ padding:M?"11px 10px":"16px" },
    card:{ background:"#091322", border:"1px solid #0e2035", borderRadius:12, padding:M?11:15, marginBottom:11 },
    cardTitle:{ fontSize:9, fontWeight:700, color:"#2d4055", marginBottom:11, textTransform:"uppercase", letterSpacing:2, fontFamily:"'IBM Plex Mono',monospace" },
    bigNum:(c="#34d399")=>({ fontSize:M?16:20, fontWeight:800, color:c, fontFamily:"'IBM Plex Mono',monospace" }),
    label:{ fontSize:8, color:"#2d4055", fontFamily:"'IBM Plex Mono',monospace", textTransform:"uppercase", letterSpacing:0.5, marginTop:2 },
    btn:(v="primary",sm=false)=>({
      padding:sm?"4px 9px":M?"8px 12px":"9px 16px", borderRadius:8, border:"none", cursor:"pointer",
      fontFamily:"'IBM Plex Mono',monospace", fontWeight:700, fontSize:sm?9:M?10:11,
      background:v==="primary"?"#062813":v==="danger"?"#1a0303":v==="warning"?"#1c0e00":v==="gold"?"#150900":v==="blue"?"#060e20":"#0a1828",
      color:v==="primary"?"#34d399":v==="danger"?"#f87171":v==="warning"?"#fcd34d":v==="gold"?"#fde68a":v==="blue"?"#60a5fa":"#64748b",
      border:`1px solid ${v==="primary"?"#0b4a28":v==="danger"?"#7f1d1d":v==="warning"?"#78350f":v==="gold"?"#78350f":v==="blue"?"#1e3a8a":"#0e1e30"}`,
      transition:"all 0.15s",
    }),
    overlay:{ position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.92)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1000,padding:14 },
    modal:{ background:"#091322", border:"1px solid #1a3a55", borderRadius:14, padding:M?16:26, maxWidth:480, width:"100%", animation:"fadeUp 0.2s ease", maxHeight:"90vh", overflowY:"auto" },
    logItem:(t)=>({ padding:"6px 10px", borderLeft:`3px solid ${t==="success"?"#22c55e":t==="danger"?"#ef4444":t==="warning"?"#f59e0b":t==="gold"?"#fbbf24":"#3b82f6"}`, background:"#060e1a", borderRadius:"0 6px 6px 0", marginBottom:3, fontSize:9, fontFamily:"'IBM Plex Mono',monospace", color:"#5a7080" }),
    bottomNav:{ position:"fixed",bottom:0,left:0,right:0,background:"#070e1c",borderTop:"1px solid #0c1e30",display:"flex",zIndex:500 },
    btab:(a)=>({ flex:1, padding:"8px 3px 6px", display:"flex", flexDirection:"column", alignItems:"center", gap:2, cursor:"pointer", background:a?"#091322":"transparent" }),
  };

  const TABS=[
    {id:"dashboard",label:"Home",icon:"ğŸ“Š"},{id:"map",label:"Map",icon:"ğŸ—ºï¸"},
    {id:"residents",label:"People",icon:"ğŸ‘¥"},{id:"missions",label:"Missions",icon:"ğŸ¯"},
    {id:"council",label:"Council",icon:"ğŸ›ï¸"},{id:"build",label:"Build",icon:"ğŸ—ï¸"},
    {id:"projects",label:"Projects",icon:"ğŸš§"},{id:"policies",label:"Policy",icon:"ğŸ“œ"},
    {id:"staff",label:"Staff",icon:"ğŸ‘”"},{id:"finance",label:"Finance",icon:"ğŸ’°"},
    {id:"factions",label:"Factions",icon:"ğŸ¤"},{id:"log",label:"Log",icon:"ğŸ“‹"},
  ];

  if(gameOver) return (
    <div style={{...S.root,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"}}>
      <style>{FONTS}</style>
      <div style={{ textAlign:"center", padding:32, maxWidth:400 }}>
        <div style={{ fontSize:64 }}>ğŸ“‰</div>
        <div style={{ fontSize:22, fontWeight:800, color:"#ef4444", margin:"12px 0 8px" }}>Game Over</div>
        <div style={{ color:"#6a8fa6", fontSize:12, fontFamily:"'IBM Plex Mono',monospace", lineHeight:1.7, marginBottom:6 }}>{gameOverReason}</div>
        <div style={{ color:"#2d4055", fontSize:9, fontFamily:"'IBM Plex Mono',monospace", marginBottom:20 }}>{MONTHS[month]} {year} Â· Pop: {population.toLocaleString()} Â· {totalMonths} months Â· {TIER_NAMES[tier]}</div>
        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8, marginBottom:16 }}>
          {[["Months",totalMonths],["Buildings",Object.keys(buildings).length],["Missions",missionsCompleted],["Policies",activePolicies.length]].map(([l,v])=>(
            <div key={l} style={{ background:"#091322", border:"1px solid #0e2035", borderRadius:8, padding:10 }}>
              <div style={{ fontFamily:"'IBM Plex Mono',monospace", fontWeight:800, fontSize:16, color:"#64748b" }}>{v}</div>
              <div style={{ fontSize:8, color:"#2d4055", textTransform:"uppercase" }}>{l}</div>
            </div>
          ))}
        </div>
        <button style={{ ...S.btn("primary"), width:"100%", padding:12 }} onClick={newGame}>ğŸ”„ New Game</button>
      </div>
    </div>
  );

  if(gameWin) {
    const avg=Math.round(Object.values(stats).reduce((a,b)=>a+b,0)/6);
    const score=Math.round(avg*0.25+Math.min(population/7000,1)*100*0.2+Math.min(budget/500000,1)*100*0.15+integrity*0.15+Math.max(0,100-crimeRate)*0.1+environment*0.1+(achievements.length/ACHIEVEMENTS.length)*100*0.05);
    return (
      <div style={{...S.root,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"}}>
        <style>{FONTS}</style>
        <div style={{ textAlign:"center", padding:M?16:32, maxWidth:500, width:"100%" }}>
          <div style={{ fontSize:64, animation:"bounceIn 0.6s ease" }}>â­</div>
          <div style={{ fontSize:20, fontWeight:800, color:"#fbbf24", margin:"10px 0 4px" }}>Star Barangay Achieved!</div>
          <div style={{ color:"#6ee7b7", fontSize:12, marginBottom:18 }}>Barangay Maunlad is the pride of the region!</div>
          <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:8, marginBottom:14 }}>
            {[["Score",`${score}/100`,"#fbbf24"],["Pop",population.toLocaleString(),"#34d399"],["Budget",fm(budget),"#60a5fa"],["Months",totalMonths,"#a78bfa"],["Integrity",Math.round(integrity)+"%","#34d399"],["Achievements",`${achievements.length}/${ACHIEVEMENTS.length}`,"#fbbf24"],["Missions",missionsCompleted,"#6ee7b7"],["Buildings",Object.keys(buildings).length,"#34d399"],["Policies",activePolicies.length,"#a78bfa"]].map(([l,v,c])=>(
              <div key={l} style={{ background:"#091322", border:"1px solid #0e2035", borderRadius:8, padding:"9px 7px" }}>
                <div style={{ fontFamily:"'IBM Plex Mono',monospace", fontWeight:800, fontSize:14, color:c }}>{v}</div>
                <div style={{ fontSize:7, color:"#2d4055", textTransform:"uppercase", letterSpacing:1 }}>{l}</div>
              </div>
            ))}
          </div>
          <div style={{ background:"#091322", border:"1px solid #0e2035", borderRadius:10, padding:11, marginBottom:14 }}>
            <div style={{ fontSize:9, color:"#2d4055", marginBottom:7, fontFamily:"'IBM Plex Mono',monospace", textTransform:"uppercase" }}>Achievements ({achievements.length}/{ACHIEVEMENTS.length})</div>
            <div style={{ display:"flex", flexWrap:"wrap", gap:4, justifyContent:"center" }}>
              {ACHIEVEMENTS.map(a=>(<span key={a.id} style={{ fontSize:15, opacity:achievements.includes(a.id)?1:0.15 }} title={a.name}>{a.emoji}</span>))}
            </div>
          </div>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8 }}>
            <button style={{ ...S.btn("primary"), padding:12 }} onClick={newGame}>ğŸ”„ Play Again</button>
            <button style={{ ...S.btn("gold"), padding:12 }} onClick={saveGame}>ğŸ’¾ Save Record</button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <>
      <style>{FONTS}</style>
      <div style={S.root}>

        {/* Toasts */}
        <div style={{ position:"fixed",top:12,right:12,zIndex:3000,display:"flex",flexDirection:"column",gap:6,pointerEvents:"none",maxWidth:240 }}>
          {toasts.map(t=>(
            <div key={t.id} style={{ background:t.type==="success"?"#02180a":t.type==="gold"?"#110800":t.type==="danger"?"#160202":"#060e1c", border:`1px solid ${t.type==="success"?"#14532d":t.type==="gold"?"#78350f":t.type==="danger"?"#7f1d1d":"#1e3a55"}`, color:t.type==="success"?"#86efac":t.type==="gold"?"#fde68a":t.type==="danger"?"#fca5a5":"#93c5fd", padding:"8px 11px", borderRadius:8, fontSize:10, fontFamily:"'IBM Plex Mono',monospace", fontWeight:600, animation:t.out?"slideOutR 0.4s forwards":"slideInR 0.3s ease" }}>{t.text}</div>
          ))}
        </div>

        {/* NPC Dialogue */}
        {npcDialogue && (
          <div style={S.overlay}>
            <div style={{ ...S.modal, maxWidth:400, textAlign:"center" }}>
              <div style={{ fontSize:54, marginBottom:8 }}>{npcDialogue.resident.emoji}</div>
              <div style={{ fontSize:14, fontWeight:800, color:"#e8f0fa", marginBottom:2 }}>{npcDialogue.resident.name}</div>
              <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", marginBottom:12 }}>{npcDialogue.resident.age} yrs old Â· {npcDialogue.resident.job} Â· {npcDialogue.resident.zone}</div>
              <div style={{ background:"#060e1a", border:"1px solid #1a3040", borderRadius:10, padding:"12px 14px", marginBottom:14, fontSize:12, color:"#c8d8e8", fontStyle:"italic", lineHeight:1.7 }}>
                "{npcDialogue.message}"
              </div>
              {npcDialogue.mission && (
                <div style={{ background:"#031a0a", border:"1px solid #0a3520", borderRadius:9, padding:10, marginBottom:14 }}>
                  <div style={{ fontSize:10, fontWeight:700, color:"#34d399", marginBottom:3 }}>{npcDialogue.mission.emoji} New Mission: {npcDialogue.mission.title}</div>
                  <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace" }}>{npcDialogue.mission.desc}</div>
                  {npcDialogue.mission.cost && <div style={{ fontSize:9, color:"#fcd34d", fontFamily:"'IBM Plex Mono',monospace", marginTop:4 }}>Cost: {fm(npcDialogue.mission.cost)} Â· Deadline: {npcDialogue.mission.deadline} months</div>}
                </div>
              )}
              <button style={{ ...S.btn("primary"), width:"100%" }} onClick={()=>setNpcDialogue(null)}>Noted, Kapitan! ğŸ‘</button>
            </div>
          </div>
        )}

        {/* Event Modal */}
        {showEvent && currentEvent && (
          <div style={S.overlay}>
            <div style={S.modal}>
              <div style={{ fontSize:40, marginBottom:5 }}>{currentEvent.emoji}</div>
              <div style={{ fontSize:16, fontWeight:800, color:"#e8f0fa", marginBottom:5 }}>{currentEvent.name}</div>
              {currentEvent.zone && <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", marginBottom:8 }}>ğŸ“ Affected Zone: {ZONES.find(z=>z.id===currentEvent.zone)?.name||currentEvent.zone}</div>}
              <div style={{ fontSize:11, color:"#5a7080", fontFamily:"'IBM Plex Mono',monospace", lineHeight:1.7, marginBottom:14 }}>{currentEvent.desc}</div>
              {currentEvent.type==="crisis" ? (
                <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
                  {currentEvent.choices.map((ch,i)=>(
                    <div key={i} style={{ background:"#060e1a", border:"1px solid #162030", borderRadius:9, padding:12, cursor:"pointer", textAlign:"left" }} onClick={()=>handleEventChoice(ch)}>
                      <div style={{ fontWeight:700, color:"#e2e8f0", marginBottom:3, fontSize:12 }}>{ch.label}</div>
                      <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", lineHeight:1.5, marginBottom:7 }}>{ch.desc}</div>
                      <div style={{ display:"flex", flexWrap:"wrap", gap:3 }}>
                        {Object.entries(ch.effects).map(([k,v])=>(
                          <span key={k} style={{ padding:"1px 6px", borderRadius:9, background:v>=0?"#03200d":"#1a0303", color:v>=0?"#4ade80":"#f87171", fontSize:8, fontFamily:"'IBM Plex Mono',monospace" }}>
                            {k==="budget"?"ğŸ’°":k==="integrity"?"âš–ï¸":k==="environment"?"ğŸŒ¿":STAT_CFG[k]?.emoji||"ğŸ“Š"} {v>=0?"+":""}{k==="budget"?fm(v):v}
                          </span>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              ):(
                <>
                  <div style={{ display:"flex", flexWrap:"wrap", gap:5, justifyContent:"center", marginBottom:14 }}>
                    {Object.entries(currentEvent.effects).map(([k,v])=>(
                      <span key={k} style={{ padding:"2px 7px", borderRadius:10, background:v>=0?"#03200d":"#1a0303", color:v>=0?"#4ade80":"#f87171", fontSize:9, fontFamily:"'IBM Plex Mono',monospace" }}>
                        {k==="budget"?"ğŸ’°":k==="integrity"?"âš–ï¸":STAT_CFG[k]?.emoji||"ğŸ“Š"} {v>=0?"+":""}{k==="budget"?fm(v):v}
                      </span>
                    ))}
                  </div>
                  <button style={{ ...S.btn("primary"), width:"100%", padding:10 }} onClick={handleGoodEvent}>Noted, Kapitan! ğŸ‘</button>
                </>
              )}
            </div>
          </div>
        )}

        {/* Council Vote Modal */}
        {councilVote && (
          <div style={S.overlay}>
            <div style={S.modal}>
              <div style={{ fontSize:36, marginBottom:5 }}>ğŸ›ï¸</div>
              <div style={{ fontSize:16, fontWeight:800, color:"#e8f0fa", marginBottom:3 }}>Council Deliberation</div>
              <div style={{ fontSize:10, color:"#5a7080", fontFamily:"'IBM Plex Mono',monospace", marginBottom:12 }}>The Sangguniang Barangay will vote on this proposal. Need {councilVote.item.councilThreshold}/8 votes to pass.</div>
              <div style={{ background:"#060e1a", border:"1px solid #162030", borderRadius:9, padding:12, marginBottom:12 }}>
                <div style={{ fontWeight:700, fontSize:13, marginBottom:4 }}>{councilVote.item.emoji} {councilVote.item.name}</div>
                <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace" }}>{councilVote.item.desc}</div>
              </div>
              <div style={{ marginBottom:12 }}>
                {COUNCIL_MEMBERS.map(m=>{
                  const loyalty=councilLoyalties[m.id]||50;
                  const fac=FACTIONS.find(f=>f.id===m.faction);
                  const likely=m.faction===councilVote.item.faction?"Likely Yes âœ“":"Uncertain â—¦";
                  const likelyColor=m.faction===councilVote.item.faction?"#22c55e":"#64748b";
                  return (
                    <div key={m.id} style={{ display:"flex", justifyContent:"space-between", padding:"6px 0", borderBottom:"1px solid #0a1830", fontSize:10 }}>
                      <span style={{ color:"#94a3b8" }}>{m.emoji} {m.name}</span>
                      <div style={{ display:"flex", gap:8, alignItems:"center" }}>
                        <span style={{ fontSize:8, color:fac?.color||"#64748b", fontFamily:"'IBM Plex Mono',monospace" }}>{fac?.emoji}</span>
                        <span style={{ fontSize:9, color:likelyColor, fontFamily:"'IBM Plex Mono',monospace" }}>{likely}</span>
                      </div>
                    </div>
                  );
                })}
              </div>
              <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8 }}>
                <button style={{ ...S.btn("primary"), padding:11 }} onClick={()=>{ const res=getCouncilVoteResult(councilVote.item); if(res.passes){ resolveCouncilVote(true); toastRef.current(`ğŸ›ï¸ Passed ${res.yeas}/8 votes!`,"gold"); } else { resolveCouncilVote(false); toastRef.current(`âŒ Failed: only ${res.yeas}/8 votes.`,"warning"); } }}>Call the Vote ğŸ—³ï¸</button>
                <button style={{ ...S.btn("ghost"), padding:11 }} onClick={()=>setCouncilVote(null)}>Withdraw ğŸ”™</button>
              </div>
            </div>
          </div>
        )}

        {/* Confirm Purchase Modal */}
        {confirmAction && (
          <div style={S.overlay}>
            <div style={{ ...S.modal, maxWidth:360, textAlign:"center" }}>
              <div style={{ fontSize:36, marginBottom:8 }}>ğŸ’¸</div>
              <div style={{ fontSize:15, fontWeight:800, color:"#e8f0fa", marginBottom:6 }}>Confirm Purchase</div>
              <div style={{ fontSize:11, color:"#5a7080", fontFamily:"'IBM Plex Mono',monospace", marginBottom:4 }}>{confirmAction.label}</div>
              <div style={{ fontSize:16, fontWeight:800, color:"#ef4444", fontFamily:"'IBM Plex Mono',monospace", marginBottom:16 }}>{fm(confirmAction.cost)}</div>
              <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8 }}>
                <button style={{ ...S.btn("primary"), padding:11 }} onClick={()=>{ confirmAction.onConfirm(); setConfirmAction(null); }}>âœ… Confirm</button>
                <button style={{ ...S.btn("danger"), padding:11 }} onClick={()=>setConfirmAction(null)}>âœ• Cancel</button>
              </div>
            </div>
          </div>
        )}

        {/* Election Modal */}
        {electionPending && (
          <div style={S.overlay}>
            <div style={S.modal}>
              <div style={{ fontSize:40, marginBottom:5 }}>ğŸ—³ï¸</div>
              <div style={{ fontSize:16, fontWeight:800, color:"#e8f0fa", marginBottom:5 }}>Election Season!</div>
              <div style={{ fontSize:10, color:"#5a7080", fontFamily:"'IBM Plex Mono',monospace", lineHeight:1.7, marginBottom:12 }}>Your term has ended. Do you seek re-election? {electionsLost>0?" âš ï¸ One more loss ends your career!":""}</div>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(2,1fr)", gap:8, marginBottom:14 }}>
                {[["Happiness",Math.round(hap)+"%",hap>60?"#22c55e":"#ef4444"],["Integrity",Math.round(integrity)+"%",integrity>60?"#22c55e":"#ef4444"],["Faction Avg",Math.round(Object.values(factions).reduce((a,b)=>a+b,0)/4)+"%","#fbbf24"],["Population",population.toLocaleString(),"#60a5fa"]].map(([l,v,c])=>(
                  <div key={l} style={{ background:"#040a12", borderRadius:8, padding:"8px 10px" }}>
                    <div style={{ fontFamily:"'IBM Plex Mono',monospace", fontWeight:800, fontSize:14, color:c }}>{v}</div>
                    <div style={{ fontSize:8, color:"#2d4055", textTransform:"uppercase" }}>{l}</div>
                  </div>
                ))}
              </div>
              <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8 }}>
                <button style={{ ...S.btn("primary"), padding:11 }} onClick={()=>handleElection(true)}>ğŸ—³ï¸ Run Again</button>
                <button style={{ ...S.btn("ghost"), padding:11 }} onClick={()=>handleElection(false)}>ğŸšª Step Down</button>
              </div>
            </div>
          </div>
        )}

        {/* Header */}
        <div style={S.header}>
          <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center" }}>
            <div>
              <div style={{ fontSize:M?14:18, fontWeight:800, color:"#34d399", letterSpacing:"-0.5px" }}>ğŸ˜ï¸ Barangay Maunlad</div>
              <div style={{ fontSize:8, color:"#1a5a36", fontFamily:"'IBM Plex Mono',monospace", marginTop:1, letterSpacing:1.5, textTransform:"uppercase" }}>{TIER_NAMES[tier]} Â· Term {electedTerms} Â· {totalMonths} months Â· ğŸ†{achievements.length}/{ACHIEVEMENTS.length}</div>
            </div>
            <div style={{ textAlign:"right" }}>
              <div style={{ fontSize:M?12:14, fontWeight:800, color:"#34d399", fontFamily:"'IBM Plex Mono',monospace" }}>{SM[month]} {year}</div>
              <div style={{ fontSize:8, color:"#1a5a36", fontFamily:"'IBM Plex Mono',monospace" }}>{SEASON_NAMES[getSeason(month)]}</div>
              <div style={{ fontSize:8, color:"#1a5a36", fontFamily:"'IBM Plex Mono',monospace" }}>ğŸ‘¥ {population.toLocaleString()} Â· {hapLabel}</div>
            </div>
          </div>
        </div>

        {/* News Ticker */}
        <div style={S.ticker}>
          <div style={{ display:"inline-block", animation:"ticker 35s linear infinite", fontSize:9, fontFamily:"'IBM Plex Mono',monospace", color:"#1a5a36", paddingLeft:"100%" }}>
            {newsItems.join("   Â·   ")}
          </div>
        </div>

        {/* Desktop Tabs */}
        {!M && <div style={S.tabs}>{TABS.map(({id,label,icon})=>(<div key={id} style={S.tab(tab===id)} onClick={()=>setTab(id)}>{icon} {label}</div>))}</div>}

        <div style={S.content}>

          {/* â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="dashboard" && (
            <>
              {/* Tutorial card â€“ first month only */}
              {!tutorialDismissed && totalMonths===0 && (
                <div style={{ background:"#040e1a", border:"1px solid #1a3a55", borderRadius:11, padding:13, marginBottom:12 }}>
                  <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:8 }}>
                    <div style={{ fontWeight:800, fontSize:12, color:"#60a5fa" }}>ğŸ‘‹ Welcome, Kapitan!</div>
                    <button style={{ ...S.btn("ghost",true), fontSize:10 }} onClick={()=>setTutorialDismissed(true)}>âœ• Dismiss</button>
                  </div>
                  <div style={{ fontSize:9, color:"#4a7090", fontFamily:"'IBM Plex Mono',monospace", lineHeight:1.8 }}>
                    ğŸ“Œ Elections happen every <b style={{ color:"#fbbf24" }}>36 months</b> â€” keep happiness &amp; faction trust high.<br/>
                    ğŸ“Œ Watch your <b style={{ color:"#34d399" }}>Net/Month</b> â€” if it's negative your budget will drain fast.<br/>
                    ğŸ“Œ Complete <b style={{ color:"#a78bfa" }}>resident missions</b> to boost factions before they expire.<br/>
                    ğŸ“Œ Use the <b style={{ color:"#f59e0b" }}>Finance tab</b> to balance tax, departments and loans carefully.<br/>
                    ğŸ“Œ Press <b style={{ color:"#34d399" }}>Advance Month</b> below to begin your first month in office. Mabuhay! ğŸ‡µğŸ‡­
                  </div>
                </div>
              )}

              {/* Zone 6 Demolition Alert */}
              {showDemolitionModal && (
                <div style={{ position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.92)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2000,padding:14 }}>
                  <div style={{ background:"#091322",border:"1px solid #7c2d12",borderRadius:14,padding:20,maxWidth:460,width:"100%",maxHeight:"90vh",overflowY:"auto" }}>
                    <div style={{ fontSize:36,textAlign:"center",marginBottom:8 }}>ğŸšï¸âš ï¸</div>
                    <div style={{ fontSize:15,fontWeight:800,color:"#f97316",textAlign:"center",marginBottom:8 }}>Zone 6 Demolition Order!</div>
                    <div style={{ fontSize:10,color:"#5a7080",fontFamily:"'IBM Plex Mono',monospace",lineHeight:1.7,marginBottom:12 }}>
                      The city government issued a demolition order for Zone 6 â€” Smokey Hillside. 820 informal settler families face losing their homes. Manang Lolit Reyes leads a delegation to your office.
                    </div>
                    <div style={{ background:"#060e1a",border:"1px solid #1a3040",borderRadius:9,padding:12,marginBottom:14,fontSize:11,color:"#c8d8e8",fontStyle:"italic" }}>
                      "Kapitan, ito ang aming tahanan. 30 taon na kaming nakatira dito. Huwag po kaming pabayaan." â€” Manang Lolit Reyes
                    </div>
                    <div style={{ display:"flex",flexDirection:"column",gap:8 }}>
                      <div style={{ background:"#062813",border:"1px solid #0b4a28",borderRadius:9,padding:12,cursor:"pointer" }} onClick={()=>handleDemolitionChoice("fight")}>
                        <div style={{ fontWeight:700,fontSize:12,color:"#34d399",marginBottom:3 }}>âš–ï¸ Fight the Order Legally (â‚±15,000)</div>
                        <div style={{ fontSize:9,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace" }}>File legal opposition. +20 settler trust, +5 integrity, +8 happiness.</div>
                      </div>
                      <div style={{ background:"#060e1a",border:"1px solid #162030",borderRadius:9,padding:12,cursor:"pointer" }} onClick={()=>handleDemolitionChoice("relocate")}>
                        <div style={{ fontWeight:700,fontSize:12,color:"#a3e635",marginBottom:3 }}>ğŸ˜ï¸ Facilitate Dignified Relocation (â‚±30,000)</div>
                        <div style={{ fontSize:9,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace" }}>Negotiate resettlement with aid. +8 settler trust, keeps peace.</div>
                      </div>
                      <div style={{ background:"#1a0303",border:"1px solid #7f1d1d",borderRadius:9,padding:12,cursor:"pointer" }} onClick={()=>handleDemolitionChoice("ignore")}>
                        <div style={{ fontWeight:700,fontSize:12,color:"#f87171",marginBottom:3 }}>ğŸ˜¶ Ignore â€” Let City Handle It</div>
                        <div style={{ fontSize:9,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace" }}>âˆ’15 settler trust, âˆ’8 integrity, âˆ’10 happiness. Very risky.</div>
                      </div>
                    </div>
                  </div>
                </div>
              )}
              {demolitionPhase==="notified" && (
                <div style={{ background:"#1a0800",border:"1px solid #7c2d12",borderRadius:9,padding:"8px 12px",marginBottom:10,cursor:"pointer" }} onClick={()=>setShowDemolitionModal(true)}>
                  <div style={{ fontSize:10,fontWeight:700,color:"#f97316",fontFamily:"'IBM Plex Mono',monospace" }}>ğŸšï¸ URGENT: Zone 6 Demolition Order â€” Tap to respond!</div>
                  <div style={{ fontSize:8,color:"#7c3d12",fontFamily:"'IBM Plex Mono',monospace",marginTop:2 }}>Settler trust: {Math.round(factions.settlers||30)}% and declining each month</div>
                </div>
              )}
              {/* Election forecast banner */}
              {nextElectionIn<=12 && (
                <div style={{ background:nextElectionIn<=3?"#140402":"#0c1200", border:`1px solid ${nextElectionIn<=3?"#7f1d1d":"#1a2d00"}`, borderRadius:9, padding:"8px 12px", marginBottom:10, display:"flex", justifyContent:"space-between", alignItems:"center" }}>
                  <div style={{ fontFamily:"'IBM Plex Mono',monospace", fontSize:9, color:nextElectionIn<=3?"#fca5a5":"#a3e635" }}>
                    ğŸ—³ï¸ Election in <b>{nextElectionIn}</b> month{nextElectionIn!==1?"s":""} Â· Win chance: <b style={{ color:electionChance>=60?"#22c55e":electionChance>=40?"#f59e0b":"#ef4444" }}>{electionChance}%</b>
                  </div>
                  <div style={{ fontSize:8, color:"#2d4055", fontFamily:"'IBM Plex Mono',monospace" }}>Boost happiness &amp; factions!</div>
                </div>
              )}

              <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:8, marginBottom:10 }}>
                {[[fm(budget),budgetColor,budget>0?"Funded":"Deficit"],[netMonthly>=0?`+${fm(netMonthly)}`:fm(netMonthly),netMonthly>=0?"#34d399":"#ef4444","Net/Month"],[`${Object.keys(buildings).length}/${BUILDINGS.length}`,"#a78bfa","Built"]].map(([v,c,l],i)=>(
                  <div key={i} style={{ background:"#091322", border:"1px solid #0e2035", borderRadius:9, padding:M?9:12 }}>
                    <div style={S.bigNum(c)}>{v}</div><div style={S.label}>{l}</div>
                  </div>
                ))}
              </div>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:8, marginBottom:10 }}>
                {[[Math.round(integrity)+"%",integrity>70?"#22c55e":integrity>45?"#f59e0b":"#ef4444","Integrity âš–ï¸"],[Math.round(crimeRate)+"%",crimeRate<20?"#22c55e":crimeRate<40?"#f59e0b":"#ef4444","Crime Rate ğŸ”’"],[Math.round(environment)+"%",environment>70?"#22c55e":environment>40?"#f59e0b":"#ef4444","Environment ğŸŒ¿"]].map(([v,c,l],i)=>(
                  <div key={i} style={{ background:"#091322", border:"1px solid #0e2035", borderRadius:9, padding:M?9:12 }}>
                    <div style={S.bigNum(c)}>{v}</div><div style={S.label}>{l}</div>
                  </div>
                ))}
              </div>

              {/* Tier progress */}
              <div style={S.card}>
                <div style={S.cardTitle}>Barangay Tier â€” {TIER_NAMES[tier]}</div>
                <div style={{ display:"flex", alignItems:"center", gap:10, marginBottom:6 }}>
                  <div style={{ flex:1, height:7, background:"#1a2535", borderRadius:4, overflow:"hidden" }}>
                    <div style={{ height:"100%", width:`${tier>=5?100:Math.min(100,Math.round((Object.values(stats).reduce((a,b)=>a+b,0)/6-[0,42,58,70,80][tier])/([0,42,58,70,80][tier+1]-[0,42,58,70,80][tier]+0.001)*100))}%`, background:`linear-gradient(90deg,${TIER_COLORS[tier]},${TIER_COLORS[Math.min(5,tier+1)]})`, borderRadius:4, transition:"width 0.7s" }} />
                  </div>
                  {tier<5&&<div style={{ fontSize:10, color:TIER_COLORS[tier+1], fontFamily:"'IBM Plex Mono',monospace", whiteSpace:"nowrap" }}>â†’ {TIER_NAMES[tier+1]}</div>}
                </div>
                <div style={{ fontSize:8, color:"#2d4055", fontFamily:"'IBM Plex Mono',monospace" }}>
                  {tier<5?`Goal: All stats â‰¥ ${[0,42,58,70,80][tier+1]||80}% Â· Pop â‰¥ ${["","2.5K","4K","5.5K","7K"][tier+1||1]} Â· Integrity â‰¥ ${[0,0,0,60,70][tier+1]||0}%`:"ğŸŒŸ Maximum tier! Win condition met!"}
                </div>
              </div>

              {/* Stat bars */}
              <div style={S.card}>
                <div style={S.cardTitle}>Community Indicators</div>
                {Object.entries(STAT_CFG).map(([k,c])=>(<SBar key={k} label={c.label} value={stats[k]} emoji={c.emoji} color={c.color} compact={M}/>))}
                <SBar label="Environment" value={environment} emoji="ğŸŒ¿" color="#22c55e" compact={M}/>
              </div>

              {/* Rings row */}
              <div style={{ display:"grid", gridTemplateColumns:"repeat(7,1fr)", gap:5, marginBottom:10 }}>
                {[...Object.entries(STAT_CFG).map(([k,c])=>([k,stats[k],c.color,c.label.slice(0,4)])),["env",environment,"#22c55e","Env"]].map(([k,v,c,l])=>(<Ring key={k} value={v} color={c} size={M?40:48} sw={4} label={l}/>))}
              </div>

              {/* Active missions reminder */}
              {activeMissions.length>0 && (
                <div style={{ ...S.card, borderColor:"#1a3a55" }}>
                  <div style={S.cardTitle}>âš¡ Active Missions ({activeMissions.length})</div>
                  {activeMissions.slice(0,2).map(m=>(
                    <div key={m.id} style={{ display:"flex", justifyContent:"space-between", fontSize:10, fontFamily:"'IBM Plex Mono',monospace", padding:"5px 0", borderBottom:"1px solid #0a1830" }}>
                      <span style={{ color:"#94a3b8" }}>{m.emoji} {m.title}</span>
                      <span style={{ color:m.monthsLeft<=1?"#ef4444":"#fbbf24" }}>{m.monthsLeft}mo left</span>
                    </div>
                  ))}
                  <button style={{ ...S.btn("blue",true), marginTop:8 }} onClick={()=>setTab("missions")}>View All Missions â†’</button>
                </div>
              )}

              {/* Warnings */}
              {stats.happiness<25 && <div style={{ background:"#150202", border:"1px solid #7f1d1d", borderRadius:9, padding:10, marginBottom:8, fontSize:10, fontFamily:"'IBM Plex Mono',monospace", color:"#fca5a5", animation:"pulse 1.8s infinite" }}>ğŸš¨ CRITICAL: Residents in revolt! {3-unhappyStreak} months until game over!</div>}
              {budget<0 && <div style={{ background:"#100600", border:"1px solid #7c2d12", borderRadius:9, padding:10, marginBottom:8, fontSize:10, fontFamily:"'IBM Plex Mono',monospace", color:"#fed7aa", animation:"pulse 2s infinite" }}>ğŸ”´ DEFICIT: Overdrawn! Bankruptcy at -â‚±75K!</div>}
              {integrity<40 && <div style={{ background:"#0d1206", border:"1px solid #365314", borderRadius:9, padding:10, marginBottom:8, fontSize:10, fontFamily:"'IBM Plex Mono',monospace", color:"#d9f99d" }}>âš–ï¸ LOW INTEGRITY: Corruption risk! Pass Open Data ordinance.</div>}
              {/* Zone 6 Status */}
              {(() => {
                const strust = Math.round(factions.settlers||30);
                const sc = strust>50?"#22c55e":strust>30?"#f59e0b":"#ef4444";
                return (
                  <div style={{ background:"#091322",border:`1px solid ${demolitionPhase==="resolved"?"#0b3520":demolitionPhase==="notified"?"#7c2d12":"#0e2035"}`,borderRadius:12,padding:M?11:15,marginBottom:11 }}>
                    <div style={{ fontSize:9,fontWeight:700,color:"#2d4055",marginBottom:8,textTransform:"uppercase",letterSpacing:2,fontFamily:"'IBM Plex Mono',monospace" }}>Zone 6 â€” Smokey Hillside ğŸšï¸</div>
                    <div style={{ display:"flex",justifyContent:"space-between",marginBottom:5 }}>
                      <span style={{ fontSize:10,color:demolitionPhase==="resolved"?"#22c55e":demolitionPhase==="notified"?"#f97316":"#64748b",fontWeight:700 }}>{demolitionPhase==="resolved"?"âœ… Resolved":demolitionPhase==="notified"?"âš ï¸ Demolition Active":"ğŸšï¸ Monitoring"}</span>
                      <span style={{ fontFamily:"'IBM Plex Mono',monospace",fontWeight:800,fontSize:14,color:sc }}>{strust}%</span>
                    </div>
                    <div style={{ height:4,background:"#1a2535",borderRadius:3,overflow:"hidden",marginBottom:5 }}>
                      <div style={{ height:"100%",width:`${strust}%`,background:"#f97316",borderRadius:3,transition:"width 0.6s" }}/>
                    </div>
                    <div style={{ fontSize:8,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace" }}>820 residents Â· Zone 6 missions done: {zone6Missions}</div>
                    {demolitionPhase==="notified"&&<button style={{ background:"#1a0800",border:"1px solid #7c2d12",borderRadius:7,color:"#f97316",padding:"4px 9px",fontSize:9,fontFamily:"'IBM Plex Mono',monospace",cursor:"pointer",marginTop:6 }} onClick={()=>setShowDemolitionModal(true)}>Respond to Demolition â†’</button>}
                  </div>
                );
              })()}
              {nextElectionIn<=3&&!electionPending && <div style={{ background:"#050b18", border:"1px solid #1e3a8a", borderRadius:9, padding:10, marginBottom:8, fontSize:10, fontFamily:"'IBM Plex Mono',monospace", color:"#93c5fd" }}>ğŸ—³ï¸ Election in {nextElectionIn} month{nextElectionIn!==1?"s":""}! Keep approval high.</div>}

              <button style={{ ...S.btn("primary"), width:"100%", padding:"12px", fontSize:M?12:13, borderRadius:10, marginTop:4 }} onClick={advanceMonth}>
                â­ï¸ Advance to {MONTHS[(month+1)%12]} {month===11?year+1:year}
              </button>
              <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:7, marginTop:7 }}>
                <button style={S.btn("blue")} onClick={()=>setTab("missions")}>ğŸ¯ Missions</button>
                <button style={S.btn("gold")} onClick={saveGame}>ğŸ’¾ Save</button>
                <button style={S.btn("warning")} onClick={loadGame}>ğŸ“‚ Load</button>
              </div>
            </>
          )}

          {/* â”€â”€ MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="map" && (
            <>
              <div style={{ fontSize:10, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", marginBottom:12 }}>
                Click a zone to see details. Buildings are zone-specific. Some events only affect specific zones.
              </div>
              {/* Zone overview cards */}
              <div style={{ display:"grid", gridTemplateColumns:M?"1fr 1fr":"repeat(5,1fr)", gap:8, marginBottom:14 }}>
                {ZONES.map(z=>{
                  const zBuildings=BUILDINGS.filter(b=>b.zone===z.id&&buildings[b.id]);
                  const hasRisk=z.risk.length>0;
                  return (
                    <div key={z.id} style={{ background:"#091322", border:`1px solid ${z.color}33`, borderRadius:10, padding:10, textAlign:"center" }}>
                      <div style={{ fontSize:22, marginBottom:3 }}>{z.emoji}</div>
                      <div style={{ fontSize:9, fontWeight:700, color:z.color, fontFamily:"'IBM Plex Mono',monospace" }}>{z.short}</div>
                      <div style={{ fontSize:8, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", marginTop:2 }}>Pop: {z.population.toLocaleString()}</div>
                      <div style={{ fontSize:7, color:"#2d4055", fontFamily:"'IBM Plex Mono',monospace", marginTop:2 }}>ğŸ—ï¸ {zBuildings.length} built</div>
                      {hasRisk && <div style={{ fontSize:7, color:"#ef4444", fontFamily:"'IBM Plex Mono',monospace", marginTop:2 }}>âš ï¸ {z.risk.join(", ")}</div>}
                    </div>
                  );
                })}
              </div>
              {/* Zone detailed list */}
              {ZONES.map(z=>{
                const zBuildings=BUILDINGS.filter(b=>b.zone===z.id);
                const builtHere=zBuildings.filter(b=>buildings[b.id]);
                const inProgress=zBuildings.filter(b=>activeProjects.find(p=>p.id===b.id));
                const zProjects=PROJECTS.filter(p=>p.zone===z.id);
                const activeZProjects=zProjects.filter(p=>activeProjects.find(ap=>ap.id===p.id));
                const completedZProjects=zProjects.filter(p=>!activeProjects.find(ap=>ap.id===p.id)&&p.completed);
                return (
                  <div key={z.id} style={S.card}>
                    <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:8 }}>
                      <div>
                        <div style={{ fontWeight:700, fontSize:13, color:z.color }}>{z.emoji} {z.name}</div>
                        <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", marginTop:2 }}>{z.desc}</div>
                      </div>
                      <div style={{ textAlign:"right" }}>
                        <div style={{ fontSize:11, fontFamily:"'IBM Plex Mono',monospace", color:"#94a3b8" }}>Pop: {z.population.toLocaleString()}</div>
                        {z.risk.length>0&&<div style={{ fontSize:8, color:"#ef4444", fontFamily:"'IBM Plex Mono',monospace" }}>âš ï¸ {z.risk.join(", ")}</div>}
                      </div>
                    </div>
                    <div style={{ marginBottom:6 }}>
                      <div style={{ fontSize:8, color:"#2d4055", fontFamily:"'IBM Plex Mono',monospace", marginBottom:5, textTransform:"uppercase", letterSpacing:1 }}>Buildings ({builtHere.length}/{zBuildings.length})</div>
                      <div style={{ display:"flex", flexWrap:"wrap", gap:4 }}>
                        {zBuildings.map(b=>{
                          const lvl=buildings[b.id]||0;
                          const ip=activeProjects.find(p=>p.id===b.id);
                          return (
                            <span key={b.id} style={{ fontSize:9, padding:"2px 7px", borderRadius:8, background:lvl>0?"#03200d":ip?"#061530":"#0a1220", color:lvl>0?"#4ade80":ip?"#60a5fa":"#2d4055", fontFamily:"'IBM Plex Mono',monospace", border:`1px solid ${lvl>0?"#14532d":ip?"#1e3a8a":"#0e1e30"}` }}>
                              {b.emoji} {b.name} {lvl>0?`L${lvl}`:ip?"ğŸ—ï¸":""}{lvl>0&&Array.from({length:b.maxLvl}).map((_,i)=>i<lvl?"â—":"â—‹").join("")}
                            </span>
                          );
                        })}
                      </div>
                    </div>
                    {zProjects.length>0 && (
                      <div>
                        <div style={{ fontSize:8, color:"#2d4055", fontFamily:"'IBM Plex Mono',monospace", marginBottom:4, textTransform:"uppercase", letterSpacing:1 }}>Major Projects</div>
                        <div style={{ display:"flex", flexWrap:"wrap", gap:4 }}>
                          {zProjects.map(p=>{
                            const ap=activeProjects.find(a=>a.id===p.id);
                            return <span key={p.id} style={{ fontSize:9, padding:"2px 7px", borderRadius:8, background:ap?"#061530":"#0a1220", color:ap?"#60a5fa":"#2d4055", fontFamily:"'IBM Plex Mono',monospace", border:`1px solid ${ap?"#1e3a8a":"#0e1e30"}` }}>{p.emoji} {p.name} {ap?`(${ap.monthsLeft}mo left)`:""}</span>;
                          })}
                        </div>
                      </div>
                    )}
                    {/* Residents in this zone */}
                    <div style={{ marginTop:8 }}>
                      <div style={{ fontSize:8, color:"#2d4055", fontFamily:"'IBM Plex Mono',monospace", marginBottom:4, textTransform:"uppercase", letterSpacing:1 }}>Residents</div>
                      <div style={{ display:"flex", flexWrap:"wrap", gap:3 }}>
                        {RESIDENTS.filter(r=>r.zone===z.id).map(r=>(
                          <span key={r.id} style={{ fontSize:9, color:"#5a7080", fontFamily:"'IBM Plex Mono',monospace" }}>{r.emoji} {r.name.split(" ")[0]}</span>
                        ))}
                      </div>
                    </div>
                  </div>
                );
              })}
            </>
          )}

          {/* â”€â”€ RESIDENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="residents" && (
            <>
              <div style={{ fontSize:10, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", marginBottom:12 }}>
                {population.toLocaleString()} total residents Â· {RESIDENTS.length} key community members tracked
              </div>
              <div style={{ display:"grid", gridTemplateColumns:M?"1fr":"1fr 1fr", gap:9 }}>
                {RESIDENTS.map(res=>{
                  const zone=ZONES.find(z=>z.id===res.zone);
                  const fac=FACTIONS.find(f=>f.id===res.faction);
                  const hasMission=activeMissions.find(m=>m.from===res.id);
                  const completedMission=completedMissions.some(id=>MISSION_POOL.find(m=>m.id===id&&m.from===res.id));
                  return (
                    <div key={res.id} style={{ ...S.card, marginBottom:0, border:`1px solid ${hasMission?"#1a3a55":completedMission?"#0a3520":"#0e2035"}` }}>
                      <div style={{ display:"flex", gap:10, alignItems:"flex-start" }}>
                        <div style={{ fontSize:36, lineHeight:1 }}>{res.emoji}</div>
                        <div style={{ flex:1 }}>
                          <div style={{ fontWeight:700, fontSize:12, color:"#dde6f0", marginBottom:1 }}>{res.name}</div>
                          <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", marginBottom:5 }}>
                            Age {res.age} Â· {res.job} Â· {zone?.short||res.zone}
                          </div>
                          <div style={{ display:"flex", gap:4, flexWrap:"wrap", marginBottom:7 }}>
                            <span style={{ fontSize:8, padding:"1px 6px", borderRadius:7, background:`${fac?.color||"#64748b"}22`, color:fac?.color||"#64748b", fontFamily:"'IBM Plex Mono',monospace" }}>{fac?.emoji} {fac?.name||res.faction}</span>
                            <span style={{ fontSize:8, padding:"1px 6px", borderRadius:7, background:"#0a1830", color:"#5a7080", fontFamily:"'IBM Plex Mono',monospace" }}>Concern: {res.concern}</span>
                          </div>
                          {/* Latest dialogue */}
                          <div style={{ fontSize:9, color:"#5a7080", fontStyle:"italic", fontFamily:"'IBM Plex Mono',monospace", lineHeight:1.5, marginBottom:6 }}>
                            "{res.dialogue[totalMonths%res.dialogue.length]}"
                          </div>
                          {hasMission && (
                            <div style={{ fontSize:8, color:"#60a5fa", fontFamily:"'IBM Plex Mono',monospace", background:"#061530", padding:"3px 7px", borderRadius:6 }}>ğŸ“Œ Has active mission: {hasMission.title}</div>
                          )}
                          {completedMission && !hasMission && (
                            <div style={{ fontSize:8, color:"#4ade80", fontFamily:"'IBM Plex Mono',monospace" }}>âœ… Mission completed</div>
                          )}
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </>
          )}

          {/* â”€â”€ MISSIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="missions" && (
            <>
              <div style={{ fontFamily:"'IBM Plex Mono',monospace", fontSize:10, color:"#3d5060", marginBottom:12 }}>
                Resident requests need your attention. Missions expire if ignored â€” costing integrity and faction trust.
                <span style={{ color:"#34d399", marginLeft:8 }}>Completed: {missionsCompleted}</span>
              </div>
              {activeMissions.length===0 && <div style={{ ...S.card, textAlign:"center", color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", fontSize:11 }}>No active missions. Advance a month to receive new requests.</div>}
              {activeMissions.map(m=>{
                const res=RESIDENTS.find(r=>r.id===m.from);
                const canAfford=!m.cost||budget>=m.cost;
                const hasBldg=!m.requirement?.building||buildings[m.requirement.building];
                const canComplete=canAfford&&hasBldg;
                return (
                  <div key={m.id} style={{ ...S.card, border:`1px solid ${m.monthsLeft<=1?"#7f1d1d":"#1a3a55"}` }}>
                    <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:8 }}>
                      <div style={{ display:"flex", gap:9, alignItems:"center" }}>
                        <div style={{ fontSize:30 }}>{res?.emoji||"ğŸ‘¤"}</div>
                        <div>
                          <div style={{ fontWeight:700, fontSize:12 }}>{m.emoji} {m.title}</div>
                          <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace" }}>From: {res?.name||m.from} Â· {res?.job}</div>
                        </div>
                      </div>
                      <div style={{ textAlign:"right" }}>
                        <div style={{ fontSize:10, fontFamily:"'IBM Plex Mono',monospace", color:m.monthsLeft<=1?"#ef4444":"#fbbf24", fontWeight:700 }}>â° {m.monthsLeft}mo left</div>
                      </div>
                    </div>
                    <div style={{ fontSize:10, color:"#5a7080", fontFamily:"'IBM Plex Mono',monospace", lineHeight:1.6, marginBottom:8 }}>{m.desc}</div>
                    {/* Rewards */}
                    <div style={{ display:"flex", flexWrap:"wrap", gap:4, marginBottom:8 }}>
                      {Object.entries(m.reward).filter(([k])=>k!=="faction"&&k!=="factionBoost").map(([k,v])=>(
                        <span key={k} style={{ fontSize:8, padding:"1px 6px", borderRadius:8, background:"#03200d", color:"#4ade80", fontFamily:"'IBM Plex Mono',monospace" }}>
                          +{v} {k==="budget"?"â‚±":""}{k}
                        </span>
                      ))}
                      {m.reward.faction && <span style={{ fontSize:8, padding:"1px 6px", borderRadius:8, background:"#0a1830", color:"#60a5fa", fontFamily:"'IBM Plex Mono',monospace" }}>+{m.reward.factionBoost} {m.reward.faction} faction</span>}
                    </div>
                    {/* Requirements */}
                    {(m.cost||m.requirement?.building) && (
                      <div style={{ fontSize:9, color:canComplete?"#5a7080":"#ef4444", fontFamily:"'IBM Plex Mono',monospace", marginBottom:8 }}>
                        {m.cost&&`ğŸ’° Cost: ${fm(m.cost)}`}{m.requirement?.building&&` Â· Requires: ${BUILDINGS.find(b=>b.id===m.requirement.building)?.name||m.requirement.building}`}
                      </div>
                    )}
                    <div style={{ display:"flex", gap:7 }}>
                      <button style={{ ...S.btn("primary",true), opacity:canComplete?1:0.4 }} disabled={!canComplete} onClick={()=>completeMission(m)}>âœ… Complete</button>
                      <button style={{ ...S.btn("danger",true) }} onClick={()=>dismissMission(m.id)}>âœ• Dismiss (-3 integrity)</button>
                    </div>
                  </div>
                );
              })}
              {completedMissions.length>0 && (
                <div style={S.card}>
                  <div style={S.cardTitle}>Completed ({completedMissions.length})</div>
                  <div style={{ display:"flex", flexWrap:"wrap", gap:5 }}>
                    {completedMissions.map(id=>{ const m=MISSION_POOL.find(x=>x.id===id); return m?<span key={id} style={{ fontSize:9, padding:"2px 8px", borderRadius:8, background:"#03200d", color:"#4ade80", fontFamily:"'IBM Plex Mono',monospace" }}>{m.emoji} {m.title}</span>:null; })}
                  </div>
                </div>
              )}
            </>
          )}

          {/* â”€â”€ COUNCIL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="council" && (
            <>
              <div style={{ fontFamily:"'IBM Plex Mono',monospace", fontSize:10, color:"#3d5060", marginBottom:12 }}>
                Sangguniang Barangay. Major ordinances need council approval. Ordinances passed: <span style={{ color:"#34d399" }}>{councilPassed}</span>
              </div>
              {/* Council members */}
              <div style={S.card}>
                <div style={S.cardTitle}>Council Members</div>
                {COUNCIL_MEMBERS.map(m=>{
                  const loyalty=councilLoyalties[m.id]||50;
                  const fac=FACTIONS.find(f=>f.id===m.faction);
                  const loyaltyColor=loyalty>65?"#22c55e":loyalty>45?"#f59e0b":"#ef4444";
                  return (
                    <div key={m.id} style={{ display:"flex", alignItems:"center", gap:10, padding:"9px 0", borderBottom:"1px solid #0a1830" }}>
                      <div style={{ fontSize:24 }}>{m.emoji}</div>
                      <div style={{ flex:1 }}>
                        <div style={{ fontSize:11, fontWeight:700, color:"#dde6f0" }}>{m.name}</div>
                        <div style={{ fontSize:8, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace" }}>{m.age} yrs Â· {m.personality} Â· Represents: <span style={{ color:fac?.color||"#64748b" }}>{fac?.emoji} {fac?.name}</span></div>
                        <div style={{ fontSize:8, color:"#2d4055", fontFamily:"'IBM Plex Mono',monospace", marginTop:1 }}>{m.desc}</div>
                      </div>
                      <div style={{ textAlign:"right" }}>
                        <div style={{ fontFamily:"'IBM Plex Mono',monospace", fontWeight:700, color:loyaltyColor, fontSize:13 }}>{Math.round(loyalty)}%</div>
                        <div style={{ fontSize:7, color:"#2d4055", textTransform:"uppercase" }}>Loyalty</div>
                      </div>
                    </div>
                  );
                })}
              </div>
              {/* Propose policies */}
              <div style={S.card}>
                <div style={S.cardTitle}>Propose Ordinance to Council</div>
                <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", marginBottom:10 }}>Each ordinance requires minimum council votes. Higher faction satisfaction = more supportive kagawads.</div>
                <div style={{ display:"flex", flexDirection:"column", gap:7 }}>
                  {POLICIES.filter(p=>!activePolicies.includes(p.id)).map(p=>{
                    const canAfford=budget>=p.cost;
                    const fac=FACTIONS.find(f=>f.id===p.faction);
                    return (
                      <div key={p.id} style={{ background:"#060e1a", border:"1px solid #0e2035", borderRadius:9, padding:11 }}>
                        <div style={{ display:"flex", justifyContent:"space-between", marginBottom:5 }}>
                          <div>
                            <span style={{ fontWeight:700, fontSize:12 }}>{p.emoji} {p.name}</span>
                            <span style={{ fontSize:8, marginLeft:8, color:fac?.color, fontFamily:"'IBM Plex Mono',monospace" }}>{fac?.emoji} {fac?.name}</span>
                          </div>
                          <span style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace" }}>Needs {p.councilThreshold}/8 votes</span>
                        </div>
                        <div style={{ fontSize:9, color:"#3d5060", fontFamily:"'IBM Plex Mono',monospace", marginBottom:7 }}>{p.desc} Â· Cost: {fm(p.cost)}{p.monthly>0?` + ${fm(p.monthly)}/mo`:""}</div>
                        <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center" }}>
                          <div style={{ display:"flex", flexWrap:"wrap", gap:3 }}>
                            {Object.entries(p.effects).filter(([k])=>k!=="budget_monthly").map(([k,v])=>(
                              <span key={k} style={{ fontSize:7, padding:"1px 5px", borderRadius:7, background:"#03200d", color:"#4ade80", fontFamily:"'IBM Plex Mono',monospace" }}>+{v} {k}</span>
                            ))}
                          </div>
                          <button style={{ ...S.btn("primary",true), opacity:canAfford?1:0.4 }} disabled={!canAfford} onClick={()=>proposeToCouncil(p)}>Propose ğŸ—³ï¸</button>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
              {/* Active policies */}
              {activePolicies.length>0 && (
                <div style={S.card}>
                  <div style={S.cardTitle}>Active Ordinances ({activePolicies.length})</div>
                  <div style={{ display:"flex", flexWrap:"wrap", gap:5 }}>
                    {activePolicies.map(pid=>{ const p=POLICIES.find(x=>x.id===pid); return p?<span key={pid} style={{ fontSize:9, padding:"2px 8px", borderRadius:8, background:"#03200d", color:"#4ade80", fontFamily:"'IBM Plex Mono',monospace" }}>{p.emoji} {p.name}</span>:null; })}
                  </div>
                </div>
              )}
            </>
          )}

          {/* â”€â”€ BUILD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="build" && (
            <>
              <div style={{ display:"flex", justifyContent:"space-between", marginBottom:9, fontFamily:"'IBM Plex Mono',monospace", fontSize:9, color:"#3d5060" }}>
                <span>Budget: <span style={{ color:"#34d399", fontWeight:700 }}>{fm(budget)}</span></span>
                <span>{Object.keys(buildings).length}/{BUILDINGS.length} built Â· Repairs: {totalRepairs}</span>
              </div>
              {Object.entries(buildingHealth).filter(([id,h])=>buildings[id]&&h<50).length>0&&(
                <div style={{ background:"#0d0600",border:"1px solid #7c2d12",borderRadius:10,padding:12,marginBottom:12 }}>
                  <div style={{ fontSize:9,fontWeight:700,color:"#f97316",marginBottom:8,textTransform:"uppercase",letterSpacing:1,fontFamily:"'IBM Plex Mono',monospace" }}>ğŸ”´ Maintenance Required</div>
                  {Object.entries(buildingHealth).filter(([id,h])=>buildings[id]&&h<50).map(([bId,health])=>{
                    const b=BUILDINGS.find(x=>x.id===bId); if(!b) return null;
                    const repCost=Math.round(b.cost*0.18*(1-health/100))+2500;
                    const canRep=budget>=repCost;
                    return (
                      <div key={bId} style={{ display:"flex",alignItems:"center",gap:10,padding:"7px 0",borderBottom:"1px solid #200800" }}>
                        <span style={{ fontSize:20 }}>{b.emoji}</span>
                        <div style={{ flex:1 }}>
                          <div style={{ fontSize:10,fontWeight:700,color:health<20?"#ef4444":"#fcd34d" }}>{b.name} â€” {health<20?"BROKEN":"DAMAGED"} ({Math.round(health)}%)</div>
                          <div style={{ height:3,background:"#1a2535",borderRadius:2,overflow:"hidden",marginTop:3 }}>
                            <div style={{ height:"100%",width:`${health}%`,background:health<20?"#ef4444":"#f59e0b",borderRadius:2 }}/>
                          </div>
                        </div>
                        <button disabled={!canRep} onClick={()=>repairBuilding(bId)} style={{ background:canRep?"#050e00":"#0a0a0a",border:`1px solid ${canRep?"#14532d":"#1a2535"}`,borderRadius:7,color:canRep?"#86efac":"#3d5060",padding:"5px 9px",fontSize:9,fontFamily:"'IBM Plex Mono',monospace",cursor:canRep?"pointer":"not-allowed",opacity:canRep?1:0.5 }}>
                          ğŸ”§ {fm(repCost)}
                        </button>
                      </div>
                    );
                  })}
                </div>
              )}
              {["health","education","recreation","safety","infra","economy","social"].map(cat=>{
                const catB=BUILDINGS.filter(b=>b.cat===cat);
                const catLabels={health:"â¤ï¸ Health",education:"ğŸ“š Education",recreation:"ğŸ® Recreation",safety:"ğŸ›¡ï¸ Safety",infra:"ğŸ”§ Infrastructure",economy:"ğŸ’¼ Economy",social:"ğŸ¤ Social"};
                return (
                  <div key={cat} style={{ marginBottom:14 }}>
                    <div style={{ fontSize:9, fontWeight:700, color:"#2d4055", textTransform:"uppercase", letterSpacing:2, fontFamily:"'IBM Plex Mono',monospace", marginBottom:6 }}>{catLabels[cat]}</div>
                    <div style={{ display:"grid", gridTemplateColumns:M?"1fr":"repeat(auto-fill,minmax(240px,1fr))", gap:8 }}>
                      {catB.map(b=>{
                        const lvl=buildings[b.id]||0, built=lvl>0;
                        const ip=activeProjects.find(p=>p.id===b.id&&p.isBuilding);
                        const canAfford=budget>=b.cost, canUpg=built&&lvl<b.maxLvl&&budget>=b.upgCost;
                        const z=ZONES.find(z=>z.id===b.zone);
                        return (
                          <div key={b.id} style={{ background:built?"#050d17":ip?"#070f1c":"#091322", border:`1px solid ${built?"#0b3520":ip?"#1a3a20":canAfford?"#0e2035":"#070e18"}`, borderRadius:9, padding:11, opacity:!canAfford&&!built&&!ip?0.45:1 }}>
                            <div style={{ display:"flex", gap:8 }}>
                              <span style={{ fontSize:22 }}>{b.emoji}</span>
                              <div style={{ flex:1 }}>
                                <div style={{ display:"flex", justifyContent:"space-between" }}>
                                  <div style={{ fontWeight:700, fontSize:11, color:built?((buildingHealth[b.id]??100)<20?"#ef4444":(buildingHealth[b.id]??100)<50?"#fcd34d":"#34d399"):ip?"#60a5fa":"#dde6f0" }}>{b.name}{built&&(buildingHealth[b.id]??100)<50?" âš ï¸":""}</div>
                                  {built&&<div style={{ height:3,background:"#1a2535",borderRadius:2,overflow:"hidden",margin:"2px 0" }}><div style={{ height:"100%",width:`${buildingHealth[b.id]??100}%`,background:(buildingHealth[b.id]??100)<20?"#ef4444":(buildingHealth[b.id]??100)<50?"#f59e0b":"#22c55e",borderRadius:2 }}/></div>}
                                  {built&&<div style={{ display:"flex",gap:2 }}>{Array.from({length:b.maxLvl}).map((_,i)=>(<div key={i} style={{ width:5,height:5,borderRadius:"50%",background:i<lvl?"#34d399":"#1a2535" }}/>))}</div>}
                                  {ip&&<span style={{ fontSize:8,color:"#60a5fa",fontFamily:"'IBM Plex Mono',monospace" }}>ğŸ—ï¸{ip.monthsLeft}mo</span>}
                                </div>
                                <div style={{ fontSize:8,color:"#2d4055",fontFamily:"'IBM Plex Mono',monospace",lineHeight:1.4,marginTop:2,marginBottom:5 }}>{b.desc} Â· ğŸ“ <span style={{ color:z?.color||"#64748b" }}>{z?.short}</span></div>
                                <div style={{ display:"flex",flexWrap:"wrap",gap:3,marginBottom:7 }}>
                                  {Object.entries(b.effects).filter(([k])=>k!=="budget_monthly").map(([k,v])=>(<span key={k} style={{ fontSize:7,padding:"1px 5px",borderRadius:7,background:"#03200d",color:"#4ade80",fontFamily:"'IBM Plex Mono',monospace" }}>+{v}{k}</span>))}
                                  {b.effects.budget_monthly&&<span style={{ fontSize:7,padding:"1px 5px",borderRadius:7,background:"#03200d",color:"#4ade80",fontFamily:"'IBM Plex Mono',monospace" }}>+â‚±{b.effects.budget_monthly*(buildings[b.id]||1)/1000}K/mo</span>}
                                  {b.bldMonths>1&&!built&&<span style={{ fontSize:7,padding:"1px 5px",borderRadius:7,background:"#06122a",color:"#60a5fa",fontFamily:"'IBM Plex Mono',monospace" }}>ğŸ—ï¸{b.bldMonths}mo</span>}
                                </div>
                                <div style={{ display:"flex",justifyContent:"space-between",alignItems:"center" }}>
                                  <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:9 }}>
                                    <span style={{ color:"#dde6f0",fontWeight:700 }}>{fm(b.cost)}</span>
                                    <span style={{ color:"#2d4055" }}> Â· {fm(b.upkeep)}/mo</span>
                                  </div>
                                  {!built&&!ip?(<button style={{ ...S.btn("primary",true),opacity:canAfford?1:0.4 }} disabled={!canAfford} onClick={()=>buildFacility(b)}>{canAfford?"Build":"Funds"}</button>):ip?null:built&&lvl>=b.maxLvl?(<span style={{ fontSize:8,color:"#22c55e",fontFamily:"'IBM Plex Mono',monospace" }}>â˜…MAX</span>):(<button style={{ ...S.btn("warning",true),opacity:canUpg?1:0.4 }} disabled={!canUpg} onClick={()=>upgradeBuilding(b)}>â¬†L{lvl+1} {fm(b.upgCost)}</button>)}
                                </div>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                );
              })}
            </>
          )}

          {/* â”€â”€ PROJECTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="projects" && (
            <>
              <div style={{ fontSize:10,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace",marginBottom:12 }}>Large-scale infrastructure. Budget: <span style={{ color:"#34d399" }}>{fm(budget)}</span> Â· Completed: {completedProjects}</div>
              {activeProjects.filter(p=>!p.isBuilding).length>0&&(
                <div style={S.card}>
                  <div style={S.cardTitle}>Under Construction</div>
                  {activeProjects.filter(p=>!p.isBuilding).map(p=>{
                    const pct=Math.round(((p.months-p.monthsLeft)/p.months)*100);
                    return (
                      <div key={p.id} style={{ marginBottom:12 }}>
                        <div style={{ display:"flex",justifyContent:"space-between",marginBottom:4 }}>
                          <div style={{ fontWeight:700,fontSize:12 }}>{p.emoji} {p.name}</div>
                          <span style={{ fontSize:9,color:"#fbbf24",fontFamily:"'IBM Plex Mono',monospace" }}>{p.monthsLeft}/{p.months} months left Â· {pct}%</span>
                        </div>
                        <div style={{ height:5,background:"#1a2535",borderRadius:3,overflow:"hidden" }}>
                          <div style={{ height:"100%",width:`${pct}%`,background:"linear-gradient(90deg,#1d4ed8,#60a5fa)",borderRadius:3,transition:"width 0.5s" }}/>
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
              <div style={{ display:"grid",gridTemplateColumns:M?"1fr":"1fr 1fr",gap:9 }}>
                {PROJECTS.map(proj=>{
                  const ip=activeProjects.find(p=>p.id===proj.id);
                  const done=completedProjectIds.includes(proj.id);
                  const canAfford=budget>=proj.cost;
                  const z=ZONES.find(z=>z.id===proj.zone);
                  return (
                    <div key={proj.id} style={{ ...S.card,marginBottom:0,opacity:ip||done?0.55:1,border:done?`1px solid #0b3520`:undefined }}>
                      <div style={{ fontSize:26,marginBottom:5 }}>{proj.emoji}</div>
                      <div style={{ fontWeight:700,fontSize:12,marginBottom:2 }}>{proj.name} {done&&<span style={{ fontSize:9,color:"#22c55e",fontFamily:"'IBM Plex Mono',monospace" }}>âœ“ COMPLETE</span>}</div>
                      <div style={{ fontSize:8,color:z?.color||"#64748b",fontFamily:"'IBM Plex Mono',monospace",marginBottom:3 }}>ğŸ“ {z?.name||proj.zone}</div>
                      <div style={{ fontSize:9,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace",lineHeight:1.5,marginBottom:7 }}>{proj.desc}</div>
                      <div style={{ display:"flex",flexWrap:"wrap",gap:3,marginBottom:8 }}>
                        {Object.entries(proj.effects).filter(([k])=>k!=="budget_monthly").map(([k,v])=>(<span key={k} style={{ fontSize:7,padding:"2px 5px",borderRadius:7,background:"#03200d",color:"#4ade80",fontFamily:"'IBM Plex Mono',monospace" }}>+{v}{k}</span>))}
                        {proj.effects.budget_monthly&&<span style={{ fontSize:7,padding:"2px 5px",borderRadius:7,background:"#03200d",color:"#4ade80",fontFamily:"'IBM Plex Mono',monospace" }}>+{fm(proj.effects.budget_monthly)}/mo {done?"âœ“ ACTIVE":""}</span>}
                      </div>
                      <div style={{ display:"flex",justifyContent:"space-between",alignItems:"center" }}>
                        <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:9 }}>
                          <span style={{ color:"#dde6f0",fontWeight:700 }}>{fm(proj.cost)}</span>
                          <span style={{ color:"#2d4055" }}> Â· {proj.months} months</span>
                        </div>
                        {done?(<span style={{ fontSize:8,color:"#22c55e",fontFamily:"'IBM Plex Mono',monospace" }}>ğŸ† Completed</span>):ip?(<span style={{ fontSize:8,color:"#60a5fa",fontFamily:"'IBM Plex Mono',monospace" }}>ğŸ—ï¸ In progress</span>):(<button style={{ ...S.btn("primary",true),opacity:canAfford?1:0.4 }} disabled={!canAfford} onClick={()=>startProject(proj)}>{canAfford?"Start":"Funds"}</button>)}
                      </div>
                    </div>
                  );
                })}
              </div>
            </>
          )}

          {/* â”€â”€ POLICIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="policies" && (
            <>
              <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:10,color:"#3d5060",marginBottom:10 }}>
                Ordinances now require council votes. Active: <span style={{ color:"#34d399" }}>{activePolicies.length}/{POLICIES.length}</span>
              </div>
              {activePolicies.length>0 && (
                <div style={S.card}>
                  <div style={S.cardTitle}>Active Ordinances</div>
                  <div style={{ display:"flex",flexWrap:"wrap",gap:5 }}>
                    {activePolicies.map(pid=>{ const p=POLICIES.find(x=>x.id===pid); return p?(<span key={pid} style={{ fontSize:9,padding:"2px 8px",borderRadius:8,background:"#03200d",color:"#4ade80",fontFamily:"'IBM Plex Mono',monospace",border:"1px solid #14532d" }}>{p.emoji} {p.name}</span>):null; })}
                  </div>
                </div>
              )}
              <div style={{ fontSize:10,color:"#60a5fa",fontFamily:"'IBM Plex Mono',monospace",marginBottom:10 }}>ğŸ’¡ Tip: Use the Council tab to propose and vote on ordinances.</div>
              <div style={{ display:"grid",gridTemplateColumns:M?"1fr":"1fr 1fr",gap:8 }}>
                {POLICIES.filter(p=>!activePolicies.includes(p.id)).map(p=>{
                  const fac=FACTIONS.find(f=>f.id===p.faction);
                  return (
                    <div key={p.id} style={{ ...S.card,marginBottom:0 }}>
                      <div style={{ display:"flex",justifyContent:"space-between",marginBottom:4 }}>
                        <div style={{ fontWeight:700,fontSize:11 }}>{p.emoji} {p.name}</div>
                        <span style={{ fontSize:8,color:fac?.color,fontFamily:"'IBM Plex Mono',monospace" }}>{fac?.emoji}</span>
                      </div>
                      <div style={{ fontSize:8,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace",lineHeight:1.5,marginBottom:6 }}>{p.desc}</div>
                      <div style={{ display:"flex",flexWrap:"wrap",gap:3,marginBottom:7 }}>
                        {Object.entries(p.effects).map(([k,v])=>(<span key={k} style={{ fontSize:7,padding:"1px 5px",borderRadius:7,background:"#03200d",color:"#4ade80",fontFamily:"'IBM Plex Mono',monospace" }}>+{v}{k}</span>))}
                        {Object.entries(p.bonus).filter(([k])=>k!=="integrity_m").map(([k,v])=>(<span key={k+"b"} style={{ fontSize:7,padding:"1px 5px",borderRadius:7,background:"#061530",color:"#60a5fa",fontFamily:"'IBM Plex Mono',monospace" }}>+{v}/mo {k}</span>))}
                      </div>
                      <div style={{ display:"flex",justifyContent:"space-between",alignItems:"center" }}>
                        <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:8 }}>
                          <span style={{ color:"#dde6f0" }}>{fm(p.cost)}</span>
                          {p.monthly>0&&<span style={{ color:"#2d4055" }}> Â· -{fm(p.monthly)}/mo</span>}
                          <span style={{ color:"#3d5060" }}> Â· {p.councilThreshold}/8 votes needed</span>
                        </div>
                        <button style={S.btn("blue",true)} onClick={()=>proposeToCouncil(p)}>Propose ğŸ›ï¸</button>
                      </div>
                    </div>
                  );
                })}
              </div>
            </>
          )}

          {/* â”€â”€ STAFF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="staff" && (
            <>
              <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:10,color:"#3d5060",marginBottom:10 }}>
                Staff: <span style={{ color:"#34d399" }}>{hiredStaff.length}</span> Â· Salaries: <span style={{ color:"#f87171" }}>-{fm(staffCost)}/mo</span>
              </div>
              {hiredStaff.length>0&&(
                <div style={S.card}>
                  <div style={S.cardTitle}>Your Team</div>
                  <div style={{ display:"flex",flexWrap:"wrap",gap:7 }}>
                    {hiredStaff.map(s=>{ const st=STAFF_TYPES.find(x=>x.id===s.type); return st?(<div key={s.id} style={{ background:"#060e1a",border:"1px solid #0e2035",borderRadius:8,padding:"7px 10px",display:"flex",alignItems:"center",gap:6 }}><span style={{ fontSize:18 }}>{st.emoji}</span><div><div style={{ fontSize:9,fontWeight:700,color:"#dde6f0" }}>{st.name}</div><div style={{ fontSize:7,color:"#2d4055",fontFamily:"'IBM Plex Mono',monospace" }}>{fm(st.salary)}/mo</div></div><button style={{ ...S.btn("danger",true),marginLeft:4 }} onClick={()=>setHiredStaff(p=>p.filter(x=>x.id!==s.id))}>âœ•</button></div>):null; })}
                  </div>
                </div>
              )}
              <div style={{ display:"grid",gridTemplateColumns:M?"1fr":"1fr 1fr",gap:8 }}>
                {STAFF_TYPES.map(st=>{ const hired=hiredStaff.filter(s=>s.type===st.id).length; const full=hired>=st.maxSlots; const canAfford=budget>=st.salary*3; return (
                  <div key={st.id} style={{ ...S.card,marginBottom:0,opacity:full?0.6:1 }}>
                    <div style={{ display:"flex",gap:8 }}>
                      <span style={{ fontSize:26 }}>{st.emoji}</span>
                      <div style={{ flex:1 }}>
                        <div style={{ fontWeight:700,fontSize:12 }}>{st.name}</div>
                        <div style={{ fontSize:8,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace",lineHeight:1.5,marginTop:2,marginBottom:7 }}>{st.desc}</div>
                        <div style={{ display:"flex",justifyContent:"space-between",alignItems:"center" }}>
                          <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:9 }}>
                            <span style={{ color:"#dde6f0" }}>{fm(st.salary)}/mo</span><span style={{ color:"#2d4055" }}> Â· {hired}/{st.maxSlots}</span>
                          </div>
                          {full?(<span style={{ fontSize:8,color:"#22c55e",fontFamily:"'IBM Plex Mono',monospace" }}>âœ“ Full</span>):(<button style={{ ...S.btn("primary",true),opacity:canAfford?1:0.4 }} disabled={!canAfford} onClick={()=>{ setHiredStaff(p=>[...p,{type:st.id,id:Date.now()}]); addLog(`Hired ${st.name}`,"success"); toastRef.current(`ğŸ‘¤ ${st.name} hired!`,"success"); }}>{canAfford?"Hire":"Funds"}</button>)}
                        </div>
                      </div>
                    </div>
                  </div>
                ); })}
              </div>
            </>
          )}

          {/* â”€â”€ FINANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="finance" && (
            <>
              <div style={S.card}>
                <div style={S.cardTitle}>Tax Rate</div>
                <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:11,color:"#94a3b8",marginBottom:7 }}>Rate: <span style={{ color:"#34d399",fontWeight:700 }}>{(taxRate*100).toFixed(1)}%</span><span style={{ fontSize:9,color:"#2d4055",marginLeft:8 }}>â†’ +{fm(Math.floor(population*taxRate*150))}/mo</span></div>
                <input type="range" min="0.005" max="0.08" step="0.005" value={taxRate} onChange={e=>setTaxRate(Number(e.target.value))} style={{ accentColor:"#059669" }}/>
                <div style={{ display:"flex",justifyContent:"space-between",fontSize:8,color:"#2d4055",fontFamily:"'IBM Plex Mono',monospace",marginTop:3 }}><span>0.5%</span><span>4%</span><span>8%</span></div>
                {taxRate>0.07&&<div style={{ marginTop:6,color:"#ef4444",fontSize:9,fontFamily:"'IBM Plex Mono',monospace" }}>âš ï¸ Very high tax: âˆ’5 happiness/mo. Residents are angry.</div>}
                {taxRate>0.05&&taxRate<=0.07&&<div style={{ marginTop:6,color:"#fcd34d",fontSize:9,fontFamily:"'IBM Plex Mono',monospace" }}>âš ï¸ High tax penalty: âˆ’3 happiness/mo</div>}
                {taxRate>0.035&&taxRate<=0.05&&<div style={{ marginTop:6,color:"#94a3b8",fontSize:9,fontFamily:"'IBM Plex Mono',monospace" }}>â„¹ï¸ Mild tax: âˆ’1 happiness/mo</div>}
                {taxRate<=0.035&&<div style={{ marginTop:6,color:"#34d399",fontSize:9,fontFamily:"'IBM Plex Mono',monospace" }}>âœ… Fair tax rate â€” no happiness penalty</div>}
              </div>
              <div style={S.card}>
                <div style={S.cardTitle}>Monthly Budget Flow</div>
                <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:10 }}>
                  {[[`IRA (Term ${electedTerms})`,35000+(electedTerms-1)*5000,"#34d399"],["Tax Revenue",Math.floor(population*taxRate*150),"#22c55e"],["Market Income",marketIncome,"#6ee7b7"],["Project Income",projectIncome,"#4ade80"]].filter(([,v])=>v>=0).map(([l,v,c])=>(<div key={l} style={{ display:"flex",justifyContent:"space-between",padding:"6px 0",borderBottom:"1px solid #0a1830" }}><span style={{ color:"#4a6070" }}>{l}</span><span style={{ color:c,fontWeight:700 }}>+{fm(v)}</span></div>))}
                  {[["Facility Upkeep",upkeep,"#ef4444"],["Department Budgets",totalDept,"#f59e0b"],["Policy Costs",policyCost,"#a78bfa"],["Staff Salaries",staffCost,"#f87171"],["Loan Repayments",loanCost,"#f97316"]].map(([l,v,c])=>(<div key={l} style={{ display:"flex",justifyContent:"space-between",padding:"6px 0",borderBottom:"1px solid #0a1830" }}><span style={{ color:"#4a6070" }}>{l}</span><span style={{ color:c,fontWeight:700 }}>-{fm(v)}</span></div>))}
                  <div style={{ display:"flex",justifyContent:"space-between",padding:"8px 0" }}><span style={{ color:"#dde6f0",fontWeight:700 }}>NET MONTHLY</span><span style={{ color:netMonthly>=0?"#22c55e":"#ef4444",fontWeight:800,fontSize:13 }}>{netMonthly>=0?"+":""}{fm(netMonthly)}</span></div>
                </div>
              </div>
              {/* Dept budgets */}
              <div style={S.card}>
                <div style={S.cardTitle}>Department Budgets</div>
                {Object.entries(deptBudgets).map(([dept,spend])=>{ const cfg=STAT_CFG[dept]; const boost=spend>8000?"+3.5/mo":spend>5000?"+2/mo":spend>2000?"+0.8/mo":spend>0?"+0.2/mo":"-1/mo"; return (<div key={dept} style={{ marginBottom:12 }}><div style={{ display:"flex",justifyContent:"space-between",marginBottom:4,fontSize:10,fontFamily:"'IBM Plex Mono',monospace" }}><span>{cfg.emoji} {cfg.label}</span><span style={{ color:spend>5000?"#22c55e":spend>2000?"#f59e0b":"#ef4444" }}>{fm(spend)}/mo â†’ {boost}</span></div><input type="range" min="0" max="15000" step="500" value={spend} onChange={e=>setDeptBudgets(p=>({...p,[dept]:Number(e.target.value)}))} style={{ accentColor:cfg.color }}/></div>); })}
              </div>
              {/* Loans */}
              {loans.length===0?(
                <div style={S.card}>
                  <div style={S.cardTitle}>Government Loans</div>
                  <div style={{ display:"flex",flexDirection:"column",gap:7 }}>
                    {[{a:100000,r:0.08,m:24},{a:250000,r:0.10,m:36},{a:500000,r:0.12,m:48}].map(l=>(
                      <div key={l.a} style={{ background:"#060e1a",border:"1px solid #162030",borderRadius:9,padding:11,cursor:"pointer" }} onClick={()=>takeLoan(l.a,l.m)}>
                        <div style={{ fontWeight:700,color:"#dde6f0",fontSize:11,marginBottom:2 }}>{fm(l.a)} @ {(l.r*100).toFixed(0)}%/yr over {l.m} months</div>
                        <div style={{ fontSize:9,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace" }}>Monthly: ~{fm(Math.floor(l.a*(1+l.r)/l.m))}</div>
                      </div>
                    ))}
                  </div>
                </div>
              ):(
                <div style={S.card}>
                  <div style={S.cardTitle}>Active Loan</div>
                  {loans.map(l=>(<div key={l.id} style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:11 }}>
                    <div style={{ display:"flex",justifyContent:"space-between",marginBottom:4 }}><span style={{ color:"#dde6f0" }}>{fm(l.principal)} loan</span><span style={{ color:"#f97316",fontWeight:700 }}>-{fm(l.monthly)}/mo</span></div>
                    <div style={{ color:"#3d5060",fontSize:9 }}>{l.remaining}/{l.totalMonths} months remaining Â· Total left: {fm(l.monthly*l.remaining)}</div>
                    <div style={{ height:4,background:"#1a2535",borderRadius:2,overflow:"hidden",marginTop:7,marginBottom:10 }}><div style={{ height:"100%",width:`${Math.round(((l.totalMonths-l.remaining)/l.totalMonths)*100)}%`,background:"#f97316",borderRadius:2,transition:"width 0.5s" }}/></div>
                    <button style={{ ...S.btn("warning",true),width:"100%",opacity:budget>=l.monthly*l.remaining?1:0.4 }} disabled={budget<l.monthly*l.remaining} onClick={()=>repayLoanEarly(l)}>ğŸ’³ Repay Early ({fm(l.monthly*l.remaining)} total) +2 Integrity</button>
                  </div>))}
                </div>
              )}
              {/* Grants */}
              <div style={S.card}>
                <div style={S.cardTitle}>Government Grants Â· Secured: {grantsSecured} Â· Integrity: {Math.round(integrity)}%</div>
                <div style={{ display:"flex",flexDirection:"column",gap:7 }}>
                  {GRANTS.map(g=>{ const last=usedGrants[g.id]; const cd=last&&totalMonths-last<g.cooldown; const cdLeft=cd?g.cooldown-(totalMonths-last):0; const intOk=integrity>=(g.req.integrity||0); const sOk=!g.req.stats||Object.entries(g.req.stats).every(([k,v])=>stats[k]>=v); const eOk=!g.req.env||environment>=g.req.env; const ok=intOk&&sOk&&eOk&&!cd; return (
                    <div key={g.id} style={{ background:"#060e1a",border:`1px solid ${ok?"#0d3520":"#0e2035"}`,borderRadius:9,padding:10,opacity:ok?1:0.55 }}>
                      <div style={{ display:"flex",justifyContent:"space-between",marginBottom:3 }}>
                        <div style={{ fontWeight:700,fontSize:11 }}>{g.emoji} {g.name}</div>
                        <div style={{ fontFamily:"'IBM Plex Mono',monospace",color:"#34d399",fontWeight:700,fontSize:11 }}>+{fm(g.amount)}</div>
                      </div>
                      <div style={{ fontSize:8,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace",lineHeight:1.4,marginBottom:6 }}>{g.desc}</div>
                      <div style={{ display:"flex",justifyContent:"space-between",alignItems:"center" }}>
                        <div style={{ fontSize:8,color:ok?"#4a6070":"#ef4444",fontFamily:"'IBM Plex Mono',monospace" }}>Req: integrityâ‰¥{g.req.integrity||0}%{g.req.stats?` + ${Object.entries(g.req.stats).map(([k,v])=>`${k}â‰¥${v}%`).join(",")}`:""}{cd?` Â· Cooldown:${cdLeft}mo`:""}</div>
                        {!cd&&<button style={{ ...S.btn(ok?"primary":"ghost",true) }} onClick={()=>ok&&applyGrant(g)} disabled={!ok}>Apply</button>}
                      </div>
                    </div>
                  ); })}
                </div>
              </div>
            </>
          )}

          {/* â”€â”€ FACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="factions" && (
            <>
              <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontSize:10,color:"#3d5060",marginBottom:10 }}>All 4 factions need â‰¥70% satisfaction for Star Barangay. They affect election outcomes.</div>
              {FACTIONS.map(f=>{
                const sat=factions[f.id];
                const satisfied=f.wants.filter(w=>buildings[w]||activePolicies.includes(w)).length;
                const members=COUNCIL_MEMBERS.filter(m=>m.faction===f.id);
                return (
                  <div key={f.id} style={S.card}>
                    <div style={{ display:"flex",justifyContent:"space-between",marginBottom:8 }}>
                      <div>
                        <div style={{ fontWeight:700,fontSize:13 }}>{f.emoji} {f.name}</div>
                        <div style={{ fontSize:8,color:"#3d5060",fontFamily:"'IBM Plex Mono',monospace",marginTop:2 }}>
                          Council reps: {members.map(m=>`${m.emoji} ${m.name.split(" ")[0]}`).join(", ")}
                        </div>
                      </div>
                      <div style={{ fontFamily:"'IBM Plex Mono',monospace",fontWeight:800,fontSize:18,color:sat>70?"#22c55e":sat>45?"#f59e0b":"#ef4444" }}>{Math.round(sat)}%</div>
                    </div>
                    <SBar label={f.name} value={sat} emoji={f.emoji} color={f.color} compact={M}/>
                    <div style={{ marginTop:7 }}>
                      <div style={{ fontSize:8,color:"#2d4055",fontFamily:"'IBM Plex Mono',monospace",marginBottom:4 }}>WANTS ({satisfied}/{f.wants.length} satisfied):</div>
                      <div style={{ display:"flex",flexWrap:"wrap",gap:4 }}>
                        {f.wants.map(w=>{ const item=BUILDINGS.find(b=>b.id===w)||POLICIES.find(p=>p.id===w); if(!item) return null; const done=buildings[w]||activePolicies.includes(w); return (<span key={w} style={{ fontSize:7,padding:"1px 6px",borderRadius:7,background:done?"#03200d":"#0a1220",color:done?"#4ade80":"#3d5060",fontFamily:"'IBM Plex Mono',monospace",border:`1px solid ${done?"#14532d":"#0e1e30"}` }}>{item.emoji} {item.name}</span>); })}
                      </div>
                    </div>
                  </div>
                );
              })}
            </>
          )}

          {/* â”€â”€ LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
          {tab==="log" && (
            <>
              <div style={S.card}>
                <div style={S.cardTitle}>Achievements ({achievements.length}/{ACHIEVEMENTS.length})</div>
                <div style={{ display:"flex",flexWrap:"wrap",gap:5 }}>
                  {ACHIEVEMENTS.map(a=>{ const e=achievements.includes(a.id); return (<div key={a.id} title={`${a.name}: ${a.desc}`} style={{ display:"flex",flexDirection:"column",alignItems:"center",gap:2,background:e?"#03200d":"#060e1a",border:`1px solid ${e?"#14532d":"#0e2035"}`,borderRadius:7,padding:"6px 8px",opacity:e?1:0.25,minWidth:44 }}><span style={{ fontSize:15 }}>{a.emoji}</span><span style={{ fontSize:6,color:e?"#4ade80":"#2d4055",fontFamily:"'IBM Plex Mono',monospace",textAlign:"center",lineHeight:1.3 }}>{a.name}</span></div>); })}
                </div>
              </div>
              <div style={{ display:"grid",gridTemplateColumns:"1fr 1fr",gap:7,marginBottom:10 }}>
                <button style={S.btn("gold")} onClick={saveGame}>ğŸ’¾ Save Game</button>
                <button style={S.btn("blue")} onClick={loadGame}>ğŸ“‚ Load Game</button>
              </div>
              <div style={S.card}>
                <div style={S.cardTitle}>Barangay Chronicles</div>
                {log.map((e,i)=>(<div key={i} style={S.logItem(e.type)}><span style={{ color:"#1e3040",marginRight:5 }}>[{e.month}]</span><span>{e.emoji} {e.text}</span></div>))}
              </div>
            </>
          )}

        </div>

        {/* Mobile Bottom Nav */}
        {M&&(
          <div style={S.bottomNav}>
            {TABS.map(({id,label,icon})=>(
              <div key={id} style={S.btab(tab===id)} onClick={()=>setTab(id)}>
                <span style={{ fontSize:13 }}>{icon}</span>
                <span style={{ fontSize:6,fontFamily:"'IBM Plex Mono',monospace",fontWeight:700,color:tab===id?"#34d399":"#2d4055",letterSpacing:0.3 }}>{label}</span>
              </div>
            ))}
          </div>
        )}
      </div>
    </>
  );
}


ReactDOM.createRoot(document.getElementById("root")).render(<BarangaySim />);

    </script>
  </body>
</html>